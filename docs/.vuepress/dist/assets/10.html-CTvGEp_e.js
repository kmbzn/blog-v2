import{_ as s,c as a,a as e,o as t}from"./app-DVb85zHU.js";const p="/assets/image-18-B47nrp2D.png",l="/assets/image-19-Cjue4mbt.png",c="/assets/image-20-HbLIweZC.png",i="/assets/image-21-CEoRu-6N.png",o="/assets/image-22-BaeCXl0w.png",r="/assets/image-23-CDznNHSb.png",u="/assets/image-24-Cf0fC9MT.png",d="/assets/image-25-C7cqF-ib.png",k={};function m(h,n){return t(),a("div",null,[...n[0]||(n[0]=[e('<h1 id="_10-string-security" tabindex="-1"><a class="header-anchor" href="#_10-string-security"><span>10. String Security</span></a></h1><h1 id="strings" tabindex="-1"><a class="header-anchor" href="#strings"><span>Strings</span></a></h1><h2 id="character-strings" tabindex="-1"><a class="header-anchor" href="#character-strings"><span>Character Strings</span></a></h2><ul><li>표준 C 라이브러리 지원 <ul><li><code>char</code> 타입의 strings</li><li><code>wchar_t</code> 타입의 wide strings</li></ul></li></ul><p><img src="'+p+`" alt=""></p><blockquote><p><strong>Figure 2.1.</strong> &quot;hello&quot;의 문자열 표현</p></blockquote><h2 id="an-example" tabindex="-1"><a class="header-anchor" href="#an-example"><span>An Example</span></a></h2><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">dowork</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">int</span> dis<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">clear</span><span class="token punctuation">(</span>dis<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">/* ... */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="multibyte-character-set" tabindex="-1"><a class="header-anchor" href="#multibyte-character-set"><span>multibyte character set</span></a></h2><ul><li>Basic execution character set <ul><li>26개의 대문자, 26개의 소문자 등</li></ul></li><li>UTF-8 <ul><li>A multibyte character set</li><li>Backward compatible</li><li>1 ~ 4 bytes</li></ul></li><li>String literals <ul><li><code>L&quot;xyz&quot;</code></li><li>Type <code>wchar_t</code></li></ul></li></ul><h2 id="strings-1" tabindex="-1"><a class="header-anchor" href="#strings-1"><span>Strings</span></a></h2><ul><li><code>const char s[3] = &quot;abc&quot;;</code><ul><li>Array의 크기는 3</li><li>Trailing null byte는 생략</li><li><code>const char s[ ] = &quot;abc&quot;;</code></li></ul></li></ul><h2 id="strings-in-c" tabindex="-1"><a class="header-anchor" href="#strings-in-c"><span>Strings in C++</span></a></h2><ul><li><code>std::basic_string</code><ul><li>Characters의 시퀀스</li><li><code>string</code>은 template specialization <code>basic_string&lt;char&gt;</code>에 대한 typedef</li><li><code>wstring</code>은 template specialization <code>basic_string&lt;wchar_t&gt;</code>에 대한 typedef</li></ul></li><li>C++ string class <ul><li>모든 일반적인 implementation은 null-terminated</li><li>Win32 <code>LSA_UNICODE_STRING</code>과 같은 일부 다른 string type은 null-terminated일 필요는 없음</li></ul></li></ul><h2 id="character-types" tabindex="-1"><a class="header-anchor" href="#character-types"><span>Character Types</span></a></h2><ul><li>three types <ul><li><code>char</code>, <code>signed char</code>, <code>unsigned char</code></li></ul></li><li>Philosophy <ul><li>Signed char and unsigned char <ul><li>작은 정수값에 적합</li></ul></li><li>Plain char <ul><li>문자열 리터럴의 각각 요소들의 타입</li><li>정수 데이터 대신 문자(character) 데이터를 위해 사용 (부호의 의미가 적은)</li></ul></li></ul></li><li>Example</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token class-name">size_t</span> len<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">char</span> cstr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;char string&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">signed</span> <span class="token keyword">char</span> scstr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;signed char string&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> ucstr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;unsigned char string&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>cstr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>scstr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* warns when char is unsigned */</span></span>
<span class="line">len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>ucstr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* warns when char is signed */</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="int" tabindex="-1"><a class="header-anchor" href="#int"><span><code>int</code></span></a></h2><ul><li><code>EOF</code> (음수 값)</li><li>또는 <code>unsigned char</code>로 해석된 <code>char data</code></li><li><code>int</code>를 반환하는 함수 <ul><li><code>fgetc()</code>, <code>getc()</code>, <code>getchar()</code>, <code>fgetwc()</code>, <code>getwc()</code>, <code>getwchar()</code></li></ul></li><li><code>&lt;ctype.h&gt;</code>에 선언된 char classification functions <ul><li><code>int</code>를 인수로 허용</li><li>예: <code>isalpha()</code></li></ul></li></ul><h2 id="example" tabindex="-1"><a class="header-anchor" href="#example"><span>Example</span></a></h2><ul><li>Code Example 분석<div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token char">&#39;a&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">char</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> “a”<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">wchar_t</span> wc<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; size of &#39;a&#39;: %d \\n&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token char">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; size of c: %d \\n&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; size of wc: %d \\n&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>wc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>C에서 sizeof(&#39;a&#39;) → ???, sizeof(c) → ???</li><li>C++에서 sizeof(&#39;a&#39;) → ???</li></ul><h2 id="unsigned-char" tabindex="-1"><a class="header-anchor" href="#unsigned-char"><span>unsigned char</span></a></h2><ul><li>객체가 어떤 type이든 될 수 있을 때 유용</li><li><code>fwrite()</code></li><li>Pure binary notation을 사용하여 표현됨이 보장</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> buf1<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x78</span><span class="token punctuation">,</span> <span class="token number">0xfa</span><span class="token punctuation">,</span> <span class="token number">0xf1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> buf2<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    FILE <span class="token operator">*</span>stream<span class="token punctuation">;</span></span>
<span class="line">    stream <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>“out<span class="token punctuation">.</span>dat”<span class="token punctuation">,</span> “wb”<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">fwrite</span><span class="token punctuation">(</span>buf1<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">fclose</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    stream <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>“out<span class="token punctuation">.</span>dat”<span class="token punctuation">,</span> “rb”<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">fread</span><span class="token punctuation">(</span>buf2<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">fclose</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">6</span> <span class="token operator">&amp;&amp;</span> buf2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">printf</span><span class="token punctuation">(</span>“<span class="token operator">%</span>x “<span class="token punctuation">,</span> buf2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">printf</span><span class="token punctuation">(</span>“\\n”<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sizing-strings" tabindex="-1"><a class="header-anchor" href="#sizing-strings"><span>Sizing Strings</span></a></h2><ul><li>Buffer overflows를 예방하기 위해 필수</li><li>The CERT C Secure Coding Standard <ul><li><code>STR31-C</code>. strings용 저장 공간이 character data와 null terminator를 위한 충분한 공간을 갖도록 보장</li></ul></li><li>용어 <ul><li>Size: array에 할당된 byte 수 (<code>sizeof(array)</code>와 동일)</li><li>Count: array의 element 수 (Visual Studio 2010의 <code>_countof(array)</code>와 동일)</li><li>Length: null terminator 앞의 character 수 (<code>strlen()</code> 결과)</li></ul></li></ul><h2 id="example-1" tabindex="-1"><a class="header-anchor" href="#example-1"><span>Example</span></a></h2><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">wchar_t</span> wide_str1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> L”<span class="token number">0123456789</span>”<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">wchar_t</span> <span class="token operator">*</span>wide_str2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">wchar_t</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">malloc</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>wide_str1<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>wide_str2 <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">/* handle error */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function">strcpy</span><span class="token punctuation">(</span>wide_str2<span class="token punctuation">,</span> wide_str1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">/* … */</span></span>
<span class="line"><span class="token function">free</span><span class="token punctuation">(</span>wide_str2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">wide_str2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="common-string-manipulation-errors" tabindex="-1"><a class="header-anchor" href="#common-string-manipulation-errors"><span>Common String Manipulation Errors</span></a></h2><ul><li>4가지 일반적인 오류 <ul><li><strong>unbounded string copies</strong> (무한 string 복사)</li><li><strong>off-by-one errors</strong></li><li>null-termination errors</li><li>String truncation</li><li>String truncation</li></ul></li></ul><h2 id="improperly-bounded-string-copies" tabindex="-1"><a class="header-anchor" href="#improperly-bounded-string-copies"><span>Improperly Bounded String Copies</span></a></h2><ul><li>데이터가 고정된 길이의 문자열로부터 복사될 때 <ul><li>예: 고정된 길이 버퍼에 표준 입력으로 읽어오는 경우</li></ul></li><li><code>gets()</code> <code>C99</code>에 추가되었으나 <code>C11</code>에서 제거</li><li>&quot;STR35-C. unbounded source에서부터 고정 길이 배열에 복사하지 마십시오.&quot;</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">get_y_or_n</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;Continue? [y] n: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">gets</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">&#39;n&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>Example 2.1.</strong> Reading from <code>stdin()</code></p></blockquote><h2 id="sprintf-function" tabindex="-1"><a class="header-anchor" href="#sprintf-function"><span><code>sprintf()</code> function</span></a></h2><ul><li>array에 output을 작성</li><li>작성된 character의 끝에 null character가 작성</li><li>target array에 필요한 최대 크기를 결정하기 어려움 <ul><li>예: <code>INT_MAX</code> → 최소 11 characters</li><li>음의 정수, floating-point values는 예측이 더 어려움</li></ul></li><li><code>snprintf()</code> 함수 <ul><li>추가 parameter: <code>size_t n</code></li><li>null char가 추가되므로 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> characters가 작성</li><li>성공 시 작성된 character 수 (excluding null char) 반환</li><li>비교적 안전하지만, format string vulnerabilities에 취약</li></ul></li></ul><h2 id="c-의-std-cin" tabindex="-1"><a class="header-anchor" href="#c-의-std-cin"><span>C++의 <code>std::cin</code></span></a></h2><ul><li>이 또한 문제점 있음</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  std<span class="token double-colon punctuation">::</span>cin <span class="token operator">&gt;&gt;</span> buf<span class="token punctuation">;</span></span>
<span class="line">  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;echo: &quot;</span> <span class="token operator">&lt;&lt;</span> buf <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>field width를 <code>ios_base::width</code> 또는 <code>setw()</code>로 설정 가능</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> characters가 추출된 후 null character가 자동으로 추가됨</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  std<span class="token double-colon punctuation">::</span>cin <span class="token operator">&gt;&gt;</span> buf<span class="token punctuation">;</span></span>
<span class="line">  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;echo: &quot;</span> <span class="token operator">&lt;&lt;</span> buf <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="off-by-one-errors" tabindex="-1"><a class="header-anchor" href="#off-by-one-errors"><span>Off-by-One Errors</span></a></h2><ul><li>또 다른 일반적인 문제</li><li>unbounded string copies와 유사</li><li>Example</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">char</span> s1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;012345678&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">char</span> s2<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;0123456789&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">char</span> <span class="token operator">*</span>dest<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">int</span> i<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">strcpy_s</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  dest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">malloc</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">11</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">&#39;\\0&#39;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;dest = %s&quot;</span><span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">/* ... */</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="null-termination-errors" tabindex="-1"><a class="header-anchor" href="#null-termination-errors"><span>Null-Termination Errors</span></a></h2><ul><li>Example</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">char</span> a<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">char</span> b<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">char</span> c<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">strncpy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;0123456789abcdef&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">strncpy</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token string">&quot;0123456789abcdef&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">strncpy</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">/* ... */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>strncpy()</code>는 처음 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> characters를 복사 <ul><li>Null-termination을 보장하지 않음</li></ul></li></ul><h2 id="string-vulnerabilities-and-exploits" tabindex="-1"><a class="header-anchor" href="#string-vulnerabilities-and-exploits"><span>String Vulnerabilities and Exploits</span></a></h2><ul><li>C 또는 C++에서 String manipulation <ul><li>외부 source의 untrusted data에서 작동할 때 위험해짐</li><li>모든 외부 데이터를 untrusted로 보는 것이 안전</li></ul></li><li>Example</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line">bool <span class="token function">IsPasswordOK</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">char</span> Password<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">gets</span><span class="token punctuation">(</span>Password<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>Password<span class="token punctuation">,</span> <span class="token string">&quot;goodpass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  bool PwStatus<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;Enter password: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  PwStatus <span class="token operator">=</span> <span class="token function">IsPasswordOK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>PwStatus <span class="token operator">==</span> false<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;Access denied&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="buffer-overflows" tabindex="-1"><a class="header-anchor" href="#buffer-overflows"><span>Buffer Overflows</span></a></h2><ul><li>Example</li></ul><p><img src="`+l+'" alt=""></p><ul><li>C 및 C++가 buffer overflows에 취약한 이유 <ul><li>Strings를 null-terminated arrays of characters로 정의</li><li>암묵적인 bounds checking을 수행하지 않음</li><li>Bounds checking을 강제하지 않는 strings에 대한 표준 라이브러리 호출 제공</li></ul></li></ul><h2 id="process-memory-organization" tabindex="-1"><a class="header-anchor" href="#process-memory-organization"><span>Process Memory Organization</span></a></h2><p><img src="'+c+'" alt=""></p><h2 id="programs-and-processes" tabindex="-1"><a class="header-anchor" href="#programs-and-processes"><span>Programs and Processes</span></a></h2><p><img src="'+i+'" alt=""></p><blockquote><p><strong>Figure 10.4</strong> Program Loading into Process Memory</p></blockquote><h2 id="stack-buffer-overflows" tabindex="-1"><a class="header-anchor" href="#stack-buffer-overflows"><span>Stack Buffer Overflows</span></a></h2><ul><li>Buffer가 stack에 위치할 때 발생 <ul><li>Stack smashing이라고도 함</li></ul></li><li>Morris Worm에 의해 사용 <ul><li>exploits는 unchecked buffer overflow를 포함</li></ul></li><li>여전히 널리 악용되고 있음</li><li>Stack frame <ul><li>한 함수가 다른 함수를 호출할 때 return address를 저장할 공간 필요</li><li>호출된 함수에 전달될 parameters와 register values를 저장할 위치도 필요</li></ul></li></ul><h2 id="stack-frame-with-functions-p-and-q" tabindex="-1"><a class="header-anchor" href="#stack-frame-with-functions-p-and-q"><span>Stack Frame with Functions P and Q</span></a></h2><p><img src="'+o+'" alt=""></p><blockquote><p><strong>Figure 10.3</strong> Examples Stack Frame with Functions P and Q</p></blockquote><h2 id="stack-management" tabindex="-1"><a class="header-anchor" href="#stack-management"><span>Stack Management</span></a></h2><ul><li>Stack은 automatic process-state data를 유지하여 program execution을 지원 <img src="'+r+'" alt=""><blockquote><p><strong>Figure 2.6.</strong> Stack management</p></blockquote></li><li>Stack frame의 정보 <ul><li>return address</li><li>local variables</li><li>frame pointer</li></ul></li><li>(Disassembly using Intel Notation)</li></ul><p><img src="'+u+`" alt=""></p><ul><li><code>foo()</code> 함수 prologue</li><li><code>foo()</code> 함수 Epilogue</li><li><code>foo()</code> 호출 후 Stack frame</li></ul><h2 id="stack-smashing" tabindex="-1"><a class="header-anchor" href="#stack-smashing"><span>Stack Smashing</span></a></h2><ul><li>Stack smashing <ul><li>Buffer overflow가 execution stack에 할당된 메모리의 데이터를 덮어쓸 때 발생</li><li>Stack segment의 buffer overflow는 공격자가 arbitrary code를 실행하도록 유도 가능</li></ul></li><li>Example</li><li>Corrupted program stack</li><li>Carefully crafted input string <ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>0</mn><mi>x</mi><mn>6</mn><mi>A</mi></mrow><annotation encoding="application/x-tex">j = 0x6A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">0</span><span class="mord mathnormal">x</span><span class="mord">6</span><span class="mord mathnormal">A</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>0</mn><mi>x</mi><mn>10</mn></mrow><annotation encoding="application/x-tex">= 0x10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span><span class="mord mathnormal">x</span><span class="mord">10</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∗</mo><mo>=</mo><mn>0</mn><mi>x</mi><mn>2</mn><mi>A</mi></mrow><annotation encoding="application/x-tex">* = 0x2A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">0</span><span class="mord mathnormal">x</span><span class="mord">2</span><span class="mord mathnormal">A</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">!</mo><mo>=</mo><mn>0</mn><mi>x</mi><mn>21</mn></mrow><annotation encoding="application/x-tex">! = 0x21</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span><span class="mord mathnormal">x</span><span class="mord">21</span></span></span></span></li></ul></li><li>Corrupted program stack</li></ul><h2 id="code-injection" tabindex="-1"><a class="header-anchor" href="#code-injection"><span>Code Injection</span></a></h2><ul><li>Return address가 덮어쓰여질 때 <ul><li>제어 흐름을 새 주소로 전달하는 것은 일반적으로 trap을 유발하고 corrupted stack을 초래</li><li>공격자가 악성 code에 대한 pointer를 포함하는 specially crafted string을 생성하는 것이 가능</li><li>악성 code는 취약한 program이 가진 권한으로 실행</li></ul></li><li>Malicious arguments <ul><li>취약한 program에 의해 legitimate input으로 수용되어야 함</li><li>다른 제어 가능한 입력과 함께 인수가 취약한 code path의 실행을 초래해야 함</li><li>Shellcode로 제어가 전달되기 전에 인수가 program을 비정상적으로 종료시키지 않아야 함</li></ul></li></ul><h2 id="code-injection-1" tabindex="-1"><a class="header-anchor" href="#code-injection-1"><span>Code Injection</span></a></h2><ul><li>Example <ul><li><code>./BufferOverflow &lt; exploit.bin</code></li></ul></li></ul><h2 id="code-injection-2" tabindex="-1"><a class="header-anchor" href="#code-injection-2"><span>Code Injection</span></a></h2><ul><li>Example (<code>execve()</code> system call을 이용한 예시) <ol><li>첫 번째 <code>mov</code> instruction은 %eax register에 <code>0xB</code> 할당</li><li><code>execve()</code> 함수 호출을 위한 세 인수는 후속 세 instructions에서 설정</li><li><code>int $0x50</code> instruction은 <code>execve()</code>를 호출하여 Linux calendar program을 실행</li></ol></li></ul><h2 id="code-injection-3" tabindex="-1"><a class="header-anchor" href="#code-injection-3"><span>Code Injection</span></a></h2><ul><li>Modified Example <ul><li><code>gets()</code> 대신 <code>fgets()</code> 사용</li><li>Buffer overflow가 여전히 발생할 수 있음</li></ul></li></ul><h2 id="code-injection-4" tabindex="-1"><a class="header-anchor" href="#code-injection-4"><span>Code Injection</span></a></h2><ul><li>Modified Example <ul><li>Exploit Code</li><li>Corrupted Stack</li></ul></li></ul><h2 id="arc-injection" tabindex="-1"><a class="header-anchor" href="#arc-injection"><span>Arc Injection</span></a></h2><ul><li>Arc injection technique <ul><li>이미 process memory에 존재하는 code로 제어를 전달</li><li>새로운 arc (control-flow transfer) 삽입</li><li><code>system()</code> 또는 <code>exec()</code>을 사용하여 commands 실행 가능</li><li>여러 함수를 순차적으로 호출 가능</li></ul></li></ul><h2 id="arc-injection-1" tabindex="-1"><a class="header-anchor" href="#arc-injection-1"><span>Arc Injection</span></a></h2><ul><li>공격자가 code injection보다 arc injection을 선호할 수 있는 이유 <ul><li>대상 시스템의 메모리에 이미 code가 존재</li><li>Footprint를 현저히 작게 유지 가능</li><li>Memory-based protection schemes로 보호할 수 없음</li></ul></li><li>Example</li></ul><h2 id="mitigation-strategies" tabindex="-1"><a class="header-anchor" href="#mitigation-strategies"><span>Mitigation Strategies</span></a></h2><ul><li>여러 전략을 결합하는 defense-in-depth tactic 채택 <ul><li>String handling에 대한 secure technique</li><li><ul><li>하나 이상의 runtime detection</li></ul></li></ul></li><li>String handling <ul><li>Character strings 처리에 대한 단일 접근 방식 선택 권장</li><li>Character strings 처리에 대한 단일 접근 방식 선택 권장</li><li>String-handling functions는 메모리 관리 방식에 따라 분류 <ul><li>Caller allocates, caller frees (<code>C99</code>, <code>OpenBSD</code>, <code>C11</code> Annex K)</li><li>Callee allocates, caller frees (<code>ISO/IEC TR 24731-2</code>)</li><li>Callee allocates, callee frees (C++ <code>std::basic_string</code>)</li></ul></li></ul></li></ul><h2 id="c11-annex-k-bounds-checking" tabindex="-1"><a class="header-anchor" href="#c11-annex-k-bounds-checking"><span><code>C11</code> Annex K Bounds-Checking</span></a></h2><ul><li>첫 번째 메모리 관리 model (caller allocates하고 caller free하는 방법)</li><li><code>C11</code> Annex K <ul><li>대안적인 라이브러리 함수 제공</li><li>output buffers가 의도한 결과를 담을 만큼 충분히 큰지 확인</li><li>충분하지 않으면 failure indicator 반환</li><li>모든 string results는 null-terminated</li></ul></li><li>예: <code>strcpy_s()</code>, <code>strcat_s()</code>, <code>strncpy_s()</code>, <code>strncat_s()</code>, ... 정의</li><li><code>ISO/IEC TR 24731-1</code>로 게시 → 나중에 <code>C11</code>에 optional extensions 세트로 통합</li><li><code>__STDC_LIB_EXT1__</code> macro 정의 필요</li><li><code>C11</code> Annex K는 normative이지만 optimal annex</li><li><code>gcc</code>에서는 implemented되지 않음</li><li>유효하지 않은 크기가 함수에 전달되면 buffer overflow problems를 겪을 수 있음</li></ul><h2 id="c11-annex-k" tabindex="-1"><a class="header-anchor" href="#c11-annex-k"><span><code>C11</code> Annex K</span></a></h2><ul><li>Example: <code>gets_s()</code></li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__STDC_WANT_LIB_EXT1__</span> <span class="token expression"><span class="token number">1</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">get_y_or_n</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">size_t</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;Continue? [y] n: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">gets_s</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> n<span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="runtime-constraint-handler-function" tabindex="-1"><a class="header-anchor" href="#runtime-constraint-handler-function"><span>Runtime-constraint-handler function</span></a></h2><ul><li>오류 감지 시 특수 runtime-constraint-handler function 호출 <ul><li>오류 메시지 출력 및/또는 program 중단 가능</li></ul></li><li><code>set_constraint_handler_s()</code> 함수를 통해 호출되는 handler function 제어 가능</li><li>&quot;<code>ERR03-C</code>. Use runtime-constraint handlers when calling functions defined by TR24731-1&quot; <ul><li>Implementation-defined behavior를 제거하기 위해 runtime-constraint handler 설치 권장</li></ul></li></ul><h2 id="c11-annex-k-1" tabindex="-1"><a class="header-anchor" href="#c11-annex-k-1"><span><code>C11</code> Annex K</span></a></h2><h2 id="c11-annex-k-2" tabindex="-1"><a class="header-anchor" href="#c11-annex-k-2"><span><code>C11</code> Annex K</span></a></h2><ul><li>Example 2.6. <code>gets_s()</code> (Improved)</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__STDC_WANT_LIB_EXT1__</span> <span class="token expression"><span class="token number">1</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">get_y_or_n</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">size_t</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;Continue? [y] n: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">gets_s</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> len<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">&#39;n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">constraint_handler_t</span> oconstraint <span class="token operator">=</span> <span class="token function">set_constraint_handler_s</span><span class="token punctuation">(</span>ignore_handler_s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">get_y_or_n</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="runtime-constraint-handler-function-1" tabindex="-1"><a class="header-anchor" href="#runtime-constraint-handler-function-1"><span>Runtime-constraint-handler function</span></a></h2><ul><li><code>ignore_handler_s()</code> 함수로 설정된 경우 <ul><li>모든 위반은 caller에게 반환</li></ul></li><li>대부분의 bounds-checking functions는 nonzero <code>errno_t</code> 반환 <ul><li><code>gets_s()</code> 함수는 null pointer 반환 (compatibility를 위해)</li></ul></li><li>&quot;<code>ERR00-C</code>. 일관되고 포괄적인 오류 처리 정책을 채택하고 시행&quot;</li><li>Original constraint handler <ul><li>라이브러리 함수가 constraint handler를 설정하는 경우, 함수는 반환 또는 종료 전에 original constraint handler를 복원해줘야 함</li></ul></li></ul><h2 id="dynamic-allocation-functions" tabindex="-1"><a class="header-anchor" href="#dynamic-allocation-functions"><span>Dynamic Allocation Functions</span></a></h2><ul><li>두 번째 메모리 관리 model (callee allocates, caller frees) <ul><li><code>ISO/IEC TR 24731-2</code></li><li><code>ISO/IEC TR 24731-2</code></li></ul></li><li>이러한 함수 사용은 나중에 buffers를 free하기 위한 추가 호출이 필요</li><li><code>ISO/IEC TR 24731-2</code>에 설명된 함수는 버퍼가 항상 필요한 데이터를 담을 수 있도록 자동 크기 조정 → 더 큰 보장 제공 <ul><li>Denial-of-service attacks를 겪을 수 있음</li></ul></li></ul><h2 id="dynamic-allocation-functions-1" tabindex="-1"><a class="header-anchor" href="#dynamic-allocation-functions-1"><span>Dynamic Allocation Functions</span></a></h2><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__STDC_WANT_LIB_EXT1__</span> <span class="token expression"><span class="token number">1</span></span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">get_y_or_n</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">size_t</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;Continue? [y] n: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>response<span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>len <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">&#39;n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">free</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">free</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Example: <code>getline()</code><ul><li>Buffer를 dynamically allocate</li><li>Buffer를 free해야 함</li></ul></li></ul><h2 id="string-stream" tabindex="-1"><a class="header-anchor" href="#string-stream"><span>String stream</span></a></h2><ul><li><code>fmemopen()</code>, <code>open_memstream()</code></li><li>함수 prototypes</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line">FILE <span class="token operator">*</span><span class="token function">fmemopen</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token operator">*</span> restrict buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict mode</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">FILE <span class="token operator">*</span><span class="token function">open_memstream</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span> restrict bufp<span class="token punctuation">,</span> <span class="token class-name">size_t</span> <span class="token operator">*</span> restrict sizep</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>open_memstream()</code>에 의해 열린 stream의 경우 <ul><li>write operations를 수용하기 위해 메모리 영역이 dynamically 증가</li><li>Caller는 할당된 메모리를 free해야 함 (line 16)</li></ul></li><li>Dynamic allocation은 safety-critical systems에서 종종 허용되지 않음</li><li>Example</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">size_t</span> size<span class="token punctuation">;</span></span>
<span class="line">    FILE <span class="token operator">*</span>stream<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    stream <span class="token operator">=</span> <span class="token function">open_memstream</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>stream <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* handle error */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">fprintf</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">fflusth</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;buf = &#39;%s&#39;, size = %zu\\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">fprintf</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token string">&quot;, world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">fclose</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;buf = &#39;%s&#39;, size = %zu\\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">free</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="c-std-basic-string" tabindex="-1"><a class="header-anchor" href="#c-std-basic-string"><span>C++ <code>std::basic_string</code></span></a></h2><h2 id="c-std-basic-string-1" tabindex="-1"><a class="header-anchor" href="#c-std-basic-string-1"><span>C++ <code>std::basic_string</code></span></a></h2><ul><li>C++ extraction operator <code>operator&gt;&gt;</code><ul><li>Field width를 설정하여 buffer overflow vulnerability 제거</li><li>Truncation 문제</li><li>예상치 못한 program behavior가 발생할 수 있음</li></ul></li><li>ISO/IEC 14882에 정의된 표준 <code>std::string class</code><ul><li>type <code>char</code>에 대한 <code>std::basic_string template</code>의 specialization</li></ul></li><li><code>basic_string class</code><ul><li>Strings에 대한 dynamic approach 사용</li><li>&quot;callee allocates, callee frees&quot; 메모리 관리 전략 → 가장 안전한 접근 방식</li></ul></li><li>Example</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">string str1 <span class="token operator">=</span> “hello<span class="token punctuation">,</span> “<span class="token punctuation">;</span></span>
<span class="line">string str2 <span class="token operator">=</span> “world”<span class="token punctuation">;</span></span>
<span class="line">string str3 <span class="token operator">=</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="example-std-cin" tabindex="-1"><a class="header-anchor" href="#example-std-cin"><span>Example: <code>std::cin</code></span></a></h3><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span></span>
<span class="line"><span class="token keyword">using</span> namepsace std<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    string str<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    cin <span class="token operator">&gt;&gt;</span> str<span class="token punctuation">;</span></span>
<span class="line">    cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;str 1: &quot;</span> <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="std-out-of-range" tabindex="-1"><a class="header-anchor" href="#std-out-of-range"><span><code>std::out_of_range</code></span></a></h2><ul><li>Subscript member <code>std::string::operator[]</code><ul><li>Exception을 던지지 않음</li><li>Example<div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">string <span class="token function">bs</span><span class="token punctuation">(</span>“<span class="token number">01234567</span>”<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">size_t i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">bs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ‘\\<span class="token number">0</span>’<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><code>at()</code> method <ul><li><code>operator[]</code>와 유사하지만, <code>pos &gt;= size()</code>이면 out_of_range exception 발생</li></ul></li><li>Example</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">string <span class="token function">bs</span><span class="token punctuation">(</span><span class="token string">&quot;01234567&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    size_t i <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    bs<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token char">&#39;\\0&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">catch</span> <span class="token punctuation">(</span>out_of_range<span class="token operator">&amp;</span> oor<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Out of Range error: &quot;</span> <span class="token operator">&lt;&lt;</span> oor<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="c-str" tabindex="-1"><a class="header-anchor" href="#c-str"><span><code>c_str()</code></span></a></h2><ul><li><code>string</code>을 null-terminated byte string으로 변환 <ul><li><code>c_str()</code> method</li><li>Example<div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">string <span class="token function">str</span><span class="token punctuation">(</span>“abcd”<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">cout <span class="token operator">&lt;&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul><h2 id="string-handling-functions" tabindex="-1"><a class="header-anchor" href="#string-handling-functions"><span>String-Handling Functions</span></a></h2><ul><li><code>gets()</code><ul><li>절대 <code>gets()</code> 함수 호출 금지</li><li>종료 newline 또는 <code>EOF</code>가 발견될 때까지 표준 입력에서 buffer로 한 줄을 읽음</li><li><code>C11</code>에서 제거</li><li><code>C11</code>에서 제거</li></ul></li><li>대체 함수 <ul><li><code>C99</code><ul><li><code>fgets()</code></li><li><code>getchar()</code></li></ul></li></ul></li><li>Example 2.9. <code>fgets()</code></li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">char</span> buf<span class="token punctuation">[</span>LINE_MAX<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">int</span> ch<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* fgets succeeds, scan for newline character */</span></span>
<span class="line">    p <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token char">&#39;\\0&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">/* newline not found, flush stdin to end of line */</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">ferror</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* fgets failed, handle error */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fgets-and-getchar" tabindex="-1"><a class="header-anchor" href="#fgets-and-getchar"><span><code>fgets()</code> and <code>getchar()</code></span></a></h2><ul><li><code>fgets()</code><ul><li>Newline character를 유지</li><li>Truncation: 사용자 입력이 잘릴 수 있음</li><li>입력할 character 수가 destination buffer의 길이보다 크면 buffer overflow 발생 가능</li></ul></li><li><code>getchar()</code><ul><li><code>stdin</code>이 가리키는 입력 stream에서 다음 character 반환</li><li>Stream이 <code>EOF</code>에 있거나 read error 발생 시 <code>EOF</code> 반환</li></ul></li></ul><h2 id="getchar" tabindex="-1"><a class="header-anchor" href="#getchar"><span><code>getchar()</code></span></a></h2><ul><li>Example 2.10. <code>getchar()</code></li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">char</span> buf<span class="token punctuation">[</span>BUFSIZ<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">int</span> ch<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">int</span> chars_read <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">ferror</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> BUFSIZ <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>ch<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    chars_read<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token comment">/* end while */</span></span>
<span class="line"></span>
<span class="line">buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">&#39;\\0&#39;</span><span class="token punctuation">;</span> <span class="token comment">/* null-terminate */</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* handle EOF */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* handle error */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>chars_read <span class="token operator">&gt;</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* handle truncation */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="c11-annext-k-gets-s" tabindex="-1"><a class="header-anchor" href="#c11-annext-k-gets-s"><span><code>C11</code> Annext K gets_s()</span></a></h2><ul><li><code>C11</code> <code>gets_s()</code> 함수 <ul><li><code>gets()</code>와 호환</li><li>더 안전한 version</li><li><code>stdin</code>에서 읽음</li><li>Newline character를 유지하지 않음</li></ul></li><li>오류 발생 시 <ul><li>입력 수행 안 함</li><li>Char array 수정 안 함</li></ul></li><li>그 외의 경우 <ul><li>지정된 char 수보다 최대 하나 적게 읽음</li><li>마지막 char 다음에 null char 작성</li></ul></li><li><code>gets_s()</code> 함수 <ul><li>완전한 한 줄을 읽을 때만 성공</li><li>완전한 줄을 읽을 수 없으면 <code>NULL</code> 반환, buffer를 null string으로 설정, 입력 stream을 다음 newline char까지 정리</li></ul></li></ul><h2 id="dynamic-allocation-functions-2" tabindex="-1"><a class="header-anchor" href="#dynamic-allocation-functions-2"><span>Dynamic Allocation Functions</span></a></h2><ul><li><code>getline()</code> 함수 <ul><li><code>ISO/IEC TR 24731-2</code>에 설명</li><li><code>ISO/IEC TR 24731-2</code>에 설명</li><li><code>fgets()</code>와 유사하지만 추가 기능 포함 <ul><li>Destination buffer를 dynamically resize</li><li>읽은 character 수 반환</li></ul></li><li>Destination buffer가 <code>malloc()</code>으로 할당된 경우에만 작동</li><li>사용자는 나중에 buffer를 명시적으로 <code>free()</code>해야 함</li></ul></li></ul><h2 id="string-handling-functions-1" tabindex="-1"><a class="header-anchor" href="#string-handling-functions-1"><span>String-Handling Functions</span></a></h2><ul><li>Example 2.12. <code>getline()</code></li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">int</span> ch<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">size_t</span> buffer_size <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">char</span> <span class="token operator">*</span>buffer <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>buffer_size<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">ssize_t</span> size<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buffer<span class="token punctuation">,</span> <span class="token operator">&amp;</span>buffer_size<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* handle error */</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    p <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token char">&#39;\\0&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">/* newline not found, flush stdin to end of line */</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">ferror</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* ... work with buffer ... */</span></span>
<span class="line"></span>
<span class="line"><span class="token function">free</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="alternative-functions-for-gets" tabindex="-1"><a class="header-anchor" href="#alternative-functions-for-gets"><span>Alternative functions for <code>gets()</code></span></a></h2><h3 id="table-2-4-alternative-functions-for-gets" tabindex="-1"><a class="header-anchor" href="#table-2-4-alternative-functions-for-gets"><span>Table 2.4. Alternative Functions for <code>gets()</code></span></a></h3><table><thead><tr><th></th><th>Standard/TR</th><th>Retains Newline Character</th><th>Dynamically Allocates Memory</th></tr></thead><tbody><tr><td><code>fgets()</code></td><td><code>C99</code></td><td>Yes</td><td>No</td></tr><tr><td><code>getline()</code></td><td><code>TR 24731-2</code></td><td>Yes</td><td>Yes</td></tr><tr><td><code>gets_s()</code></td><td><code>C11</code></td><td>No</td><td>No</td></tr></tbody></table><h2 id="strcpy-and-strcat" tabindex="-1"><a class="header-anchor" href="#strcpy-and-strcat"><span><code>strcpy()</code> and <code>strcat()</code></span></a></h2><ul><li><code>C99</code><ul><li>C 표준 <code>strncpy()</code> 함수가 종종 대안으로 권장 <ul><li><code>strncpy()</code>는 null-termination errors 및 기타 문제에 취약</li></ul></li></ul></li><li><code>OpenBSD</code><ul><li><code>strlcpy()</code> 및 <code>strlcat()</code></li><li>Size parameter로 destination string의 전체 크기 사용</li><li>Destination string이 null-terminated임을 보장</li><li>생성하려고 시도한 string의 총 길이 반환</li></ul></li></ul><h2 id="c11-annex-k-bounds-checking-interfaces" tabindex="-1"><a class="header-anchor" href="#c11-annex-k-bounds-checking-interfaces"><span><code>C11</code> Annex K Bounds-Checking interfaces</span></a></h2><h2 id="c11-annex-k-bounds-checking-interfaces-1" tabindex="-1"><a class="header-anchor" href="#c11-annex-k-bounds-checking-interfaces-1"><span><code>C11</code> Annex K Bounds-Checking interfaces</span></a></h2><ul><li><code>strcpy_s()</code> 및 <code>strcat_s()</code><ul><li>성공 시 <code>0</code> 반환</li><li>그 외의 경우 nonzero value 반환</li><li>다양한 runtime constraints 강제 <ul><li>s1 또는 s2가 null pointer인 경우</li><li>Destination buffer의 크기가 <code>0</code>, <code>RSIZE_MAX</code>보다 크거나, source string의 길이보다 작거나 같은 경우</li></ul></li></ul></li></ul><h2 id="string-copy-functions" tabindex="-1"><a class="header-anchor" href="#string-copy-functions"><span>String copy functions</span></a></h2><h3 id="table-2-5-string-copy-functions" tabindex="-1"><a class="header-anchor" href="#table-2-5-string-copy-functions"><span>Table 2.5. String Copy Functions</span></a></h3><table><thead><tr><th></th><th>Standard/TR</th><th>Buffer Overflow Protection</th><th>Guarantees Null Termination</th><th>May Truncate String</th><th>Allocates Dynamic Memory</th></tr></thead><tbody><tr><td><code>strcpy()</code></td><td>C99</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td><code>strncpy()</code></td><td>C99</td><td>Yes</td><td>No</td><td>Yes</td><td>No</td></tr><tr><td><code>strlcpy()</code></td><td><code>OpenBSD</code></td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td><code>strdup()</code></td><td>TR 24731-2</td><td>Yes</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td><code>strcpy_s()</code></td><td>C11</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr></tbody></table><h3 id="table-2-6-string-concatenation-functions" tabindex="-1"><a class="header-anchor" href="#table-2-6-string-concatenation-functions"><span>Table 2.6. String Concatenation Functions</span></a></h3><table><thead><tr><th></th><th>Standard/TR</th><th>Buffer Overflow Protection</th><th>Guarantees Null Termination</th><th>May Truncate String</th><th>Allocates Dynamic Memory</th></tr></thead><tbody><tr><td><code>strcat()</code></td><td>C99</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td><code>strncat()</code></td><td>C99</td><td>Yes</td><td>No</td><td>Yes</td><td>No</td></tr><tr><td><code>strlcat()</code></td><td><code>OpenBSD</code></td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td><code>strcat_s()</code></td><td>C11</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr></tbody></table><h2 id="strncpy-and-strncat" tabindex="-1"><a class="header-anchor" href="#strncpy-and-strncat"><span><code>strncpy()</code> and <code>strncat()</code></span></a></h2><ul><li><code>size_t parameter n</code> 추가</li><li><code>strncpy()</code><ul><li>Destination string의 null-terminate를 보장하지 않음</li><li>String termination errors에 취약</li></ul></li><li><code>strncat(s1, s2, n)</code><ul><li>S1 buffer의 최소 크기는 <code>strlen(s1) + n + 1</code>이어야 함</li><li>S1 buffer의 최소 크기는 <code>strlen(s1) + n + 1</code>이어야 함</li><li><code>strncat()</code>의 마지막 인수는 총 buffer length가 아니어야 함</li><li><code>strncat(dest, source, dest_size – strlen(dest) – 1)</code></li></ul></li><li>결과 string이 잘릴 때 status code 없음</li></ul><h2 id="strncpy-s" tabindex="-1"><a class="header-anchor" href="#strncpy-s"><span><code>strncpy_s()</code></span></a></h2><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token class-name">errno_t</span> <span class="token function">strncpy_s</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">char</span> <span class="token operator">*</span> restrict s1<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">rsize_t</span> s1max<span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict s2<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">rsize_t</span> n</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Runtime-constraint violation 발생 시 destination array는 empty string으로 설정</li><li>Null terminator 추가됨</li><li>성공을 나타내기 위해 <code>0</code> 반환</li><li>입력 인수가 유효하지 않으면 nonzero value 반환</li><li>No truncation!</li><li>Example</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">char</span> src1<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">char</span> src2<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token char">&#39;g&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;o&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;o&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;d&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;y&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;e&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">char</span> dst1<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dst2<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dst3<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">errno t r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> r3<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>r1 = strncpy_s(dst1, sizeof(dst1), src1, sizeof(src1));</code><ul><li><code>r1 = 0, dst1 = “hello\\0”</code></li></ul></li><li><code>r2 = strncpy_s(dst2, sizeof(dst2), src2, 4);</code><ul><li><code>r2 = 0, dst2 = “good\\0”</code></li></ul></li><li><code>r3 = strncpy_s(dst3, sizeof(dst3), src1, sizeof(src1));</code><ul><li><code>r3 = nonzero value, dst3[0] = ‘\\0’</code></li></ul></li></ul><h2 id="summary-of-strcpy-and-strcat" tabindex="-1"><a class="header-anchor" href="#summary-of-strcpy-and-strcat"><span>Summary of <code>strcpy()</code> and <code>strcat()</code></span></a></h2><h3 id="table-2-7-truncating-copy-functions" tabindex="-1"><a class="header-anchor" href="#table-2-7-truncating-copy-functions"><span>Table 2.7. Truncating Copy Functions</span></a></h3><table><thead><tr><th></th><th>Standard/TR</th><th>Buffer Overflow Protection</th><th>Guarantees Null Termination</th><th>May Truncate String</th><th>Allocates Dynamic Memory</th><th>Checks Runtime Constraints</th></tr></thead><tbody><tr><td><code>strncpy()</code></td><td><code>C99</code></td><td>Yes</td><td>No</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td><code>strlcpy()</code></td><td><code>OpenBSD</code></td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td><code>strndup()</code></td><td><code>TR 24731-2</code></td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td><code>strncpy_s()</code></td><td><code>C11</code></td><td>Yes</td><td>Yes</td><td>No</td><td>No</td><td>Yes</td></tr></tbody></table><table><thead><tr><th></th><th>Standard/TR</th><th>Buffer Overflow Protection</th><th>Guarantees Null Termination</th><th>May Truncate String</th><th>Allocates Dynamic Memory</th><th>Checks Runtime Constraints</th></tr></thead><tbody><tr><td><code>strncat()</code></td><td><code>C99</code></td><td>Yes</td><td>No</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td><code>strlcat()</code></td><td><code>OpenBSD</code></td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td><code>strncat_s()</code></td><td><code>C11</code></td><td>Yes</td><td>Yes</td><td>No</td><td>No</td><td>Yes</td></tr></tbody></table><h2 id="runtime-protection-strategies" tabindex="-1"><a class="header-anchor" href="#runtime-protection-strategies"><span>Runtime Protection Strategies</span></a></h2><ul><li>Programmer가 불완전한 detection and recovery strategy를 사용하여 문제를 해결했다고 잘못된 확신을 가질 위험</li><li>Buffer overflow mitigation strategies <ul><li>Mitigation mechanism을 제공하는 시스템의 component에 따라 분류 가능 <ul><li>개발자 (입력 validation을 통해)</li><li>Compiler 및 관련 runtime system</li><li>Operating system</li></ul></li></ul></li></ul><h2 id="input-validation" tabindex="-1"><a class="header-anchor" href="#input-validation"><span>Input validation</span></a></h2><ul><li>Buffer overflows를 완화하는 가장 좋은 방법</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">char</span> buff<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">strncpy</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">/* ... */</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Trust boundary를 넘어 program interface에 도달하는 모든 데이터는 validation 필요 <ul><li>예: <code>argv</code> 및 <code>argc</code>, environment variables, <code>sockets/files/devices</code>에서 읽은 데이터</li></ul></li></ul><h2 id="object-size-checking" tabindex="-1"><a class="header-anchor" href="#object-size-checking"><span>Object Size Checking</span></a></h2><ul><li>GCC <ul><li>Pointer가 가리키는 객체의 크기에 접근하기 위한 제한된 기능 제공</li><li>GCC 4.1: <code>size_t __builtin_object_size(void *ptr, int type)</code><ul><li><code>ptr</code>: 객체의 시작 부분을 가리켜야 함</li><li><code>type</code>: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">0 \\sim 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 또는 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>: 참조된 객체는 가리키는 byte를 포함하는 가장 큰 객체</li><li>그 외: 객체는 가장 작은 객체</li></ul></li><li>Byte 수 반환</li></ul></li></ul></li><li>Example</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">struct</span> <span class="token class-name">V</span> <span class="token punctuation">{</span> <span class="token keyword">char</span> buf1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">int</span> b<span class="token punctuation">;</span> <span class="token keyword">char</span> buf2<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> var<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token operator">*</span>ptr <span class="token operator">=</span> <span class="token operator">&amp;</span>var<span class="token punctuation">.</span>b<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>__builtin_object_size(ptr, 0)</code></p></li><li><p><code>__builtin_object_size(ptr, 1)</code></p></li><li><p><code>__builtin_object_size()</code> 함수</p><ul><li><code>_FORTIFY_SOURCE</code>가 정의될 때 사용</li></ul></li></ul><h2 id="object-size-checking-1" tabindex="-1"><a class="header-anchor" href="#object-size-checking-1"><span>Object Size Checking</span></a></h2><table><thead><tr><th>Value of type Argument</th><th>Operates on</th><th>If Unknown, Returns</th></tr></thead><tbody><tr><td>0</td><td>Maximum object</td><td>(size_t) -1</td></tr><tr><td>1</td><td>Minimum object</td><td>(size_t) -1</td></tr><tr><td>2</td><td>Maximum object</td><td>(size_t) 0</td></tr><tr><td>3</td><td>Minimum object</td><td>(size_t) 0</td></tr></tbody></table><ul><li>크기 결정 불가</li><li><code>src_end</code> = <code>‘\\0’</code>를 포함한 byte 수</li></ul><h2 id="visual-studio-compiler-generated-runtime-checks" tabindex="-1"><a class="header-anchor" href="#visual-studio-compiler-generated-runtime-checks"><span>Visual Studio Compiler-Generated Runtime Checks</span></a></h2><ul><li>Visual C++ 2010 <ul><li><code>/RTCs</code> compiler flag <ul><li>Arrays와 같은 local variables의 overflows</li><li>초기화되지 않은 variables 사용</li><li>Stack pointer corruption</li><li>등의 runtime checks 활성화</li></ul></li><li><code>/GS</code></li><li>Pragma를 사용하여 flags 조정 가능</li></ul></li></ul><h2 id="stack-smashing-protector-propolice" tabindex="-1"><a class="header-anchor" href="#stack-smashing-protector-propolice"><span>Stack-Smashing Protector (ProPolice)</span></a></h2><ul><li><code>GCC 4.1</code><ul><li>Stack-Smashing Protector (SSP) 기능 도입</li><li>Buffers 뒤에 pointers를 배치하도록 local variables 재정렬</li><li>함수 인수의 pointers를 local variable buffers 앞 영역으로 복사</li></ul></li><li>SSP <ul><li>Canary를 도입하여 변경 사항 감지</li></ul></li><li>SSP stack structure</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">                  ┌────────────────────────────┐ ▲</span>
<span class="line">Stack pointer ──► │            ...             │ │</span>
<span class="line">                  ├────────────────────────────┤ │</span>
<span class="line">                  │    local variables (C)     │ │</span>
<span class="line">                  ├────────────────────────────┤ │</span>
<span class="line">                  │         arrays (B)         │ │</span>
<span class="line">                  ├────────────────────────────┤ │</span>
<span class="line">                  │           guard            │ ├─── stack</span>
<span class="line">Frame pointer ──► ├────────────────────────────┤ │    guard</span>
<span class="line">                  │   previous frame pointer   │ │</span>
<span class="line">                  ├────────────────────────────┤ │</span>
<span class="line">                  │       return address       │ │</span>
<span class="line">                  ├────────────────────────────┤</span>
<span class="line">                  │       arguments (A)        │</span>
<span class="line">                  ├────────────────────────────┤</span>
<span class="line">                  │            ...             │</span>
<span class="line">                  └────────────────────────────┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>위치 (A): array 또는 pointer variables 없음</li><li>위치 (B): arrays를 포함하는 arrays 또는 structures</li><li>위치 (B) 뒤에 guard 배치</li><li>위치 (C): arrays 없음</li><li>Stack guard</li></ul><h2 id="operating-system-strategies" tabindex="-1"><a class="header-anchor" href="#operating-system-strategies"><span>Operating System Strategies</span></a></h2><ul><li>Address space layout randomization (ASLR) <ul><li>Arbitrary code execution 방지</li><li>Linux, Windows Vista 이후 사용 가능</li><li>개발자는 <code>/DYNAMICBASE</code> linker option을 사용하여 ASLR 지원에 opt in 해야 함</li></ul></li><li>Nonexecutable stacks <ul><li>공격자가 stack에서 executable code를 실행하는 것을 허용하지 않음</li></ul></li><li>W ^ X (W xor X) <ul><li>Process address space의 어떤 부분도 writable이면서 executable이지 않음</li><li>여러 CPU에서 No eXecute (NX) bit 사용으로 지원</li></ul></li><li>Data Execution Prevention (DEP) <ul><li>Microsoft Visual Studio용 W ^ X 정책의 implementation</li><li>NX technology를 사용하여 data segments에 저장된 instructions의 실행 방지</li><li><code>/NXCOMPACT</code>로 code를 link하거나 <code>SetProcessDEPPolicy()</code> 호출로 DEP 활성화</li></ul></li><li>PaX <ul><li>Linux kernel security patch</li><li>Nonexecutable stack, ASLR 등</li><li>Denial of Service (DoS) 유발 가능</li><li>현재 grsecurity project의 일부</li></ul></li><li>StackGap <ul><li>Stack memory 할당 시 randomly sized gap 도입</li></ul></li></ul><h2 id="future-direction" tabindex="-1"><a class="header-anchor" href="#future-direction"><span>Future Direction</span></a></h2><blockquote><p>Figure 2.19. A possible Safe-Secure C/C++(SSCC) implementation <img src="`+d+'" alt="alt text"></p></blockquote><ul><li>가능한 Safe-Secure C/C++ (SSCC) implementation</li></ul><h2 id="notable-vulnerabilities" tabindex="-1"><a class="header-anchor" href="#notable-vulnerabilities"><span>Notable Vulnerabilities</span></a></h2><ul><li>Remote Login (rlogin) <ul><li>Buffer overflow: <code>TERM environment variable</code>을 local stack variable로 선언된 1,024 characters array로 복사</li></ul></li><li>Kerberos <ul><li>Network authentication protocol</li><li><a href="http://web.mit.edu/Kerberos/" target="_blank" rel="noopener noreferrer">http://web.mit.edu/Kerberos/</a></li><li><code>krb_rd_req()</code> 함수에서 buffer overflow <ul><li>공격자가 네트워크를 통해 root access 얻을 수 있음</li></ul></li></ul></li></ul><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><ul><li>C 및 C++에서 buffer overflows가 자주 발생하는 이유 <ol><li>Strings를 null-terminated arrays of characters로 정의</li><li>암묵적인 bounds checking을 수행하지 않음</li><li>Bounds checking을 강제하지 않는 표준 라이브러리 호출 제공</li></ol></li><li>일반적인 완화 전략은 새로운 라이브러리 채택</li><li>실용적인 완화 전략은 static analysis 및 dynamic analysis 포함</li><li>Runtime solutions <ul><li>Bounds checkers, canaries, safe libraries</li></ul></li><li>Defense-in-depth strategy</li></ul><h1 id="시험-정보" tabindex="-1"><a class="header-anchor" href="#시험-정보"><span>시험 정보</span></a></h1><p>장소: 501호</p>',190)])])}const b=s(k,[["render",m]]),g=JSON.parse('{"path":"/cs/10.html","title":"10. String Security","lang":"ko-KR","frontmatter":{},"git":{"updatedTime":1764557314000,"contributors":[{"name":"kmbzn","username":"kmbzn","email":"kmbzn24@gmail.com","commits":5,"url":"https://github.com/kmbzn"}],"changelog":[{"hash":"6250b03a59855d871ef1d178829abafb9b97e947","time":1764557314000,"email":"kmbzn24@gmail.com","author":"kmbzn","message":"docs: Add detailed explanation of __builtin_object_size() and _FORTIFY_SOURCE security feature"},{"hash":"c3fb48b4a8fc8b0e4d69309c49ff01dd11ece704","time":1764508645000,"email":"kmbzn24@gmail.com","author":"kmbzn","message":"update cs/10"},{"hash":"f81f9042e7888855a506f92261c74aaa2d86aa2a","time":1764305376000,"email":"kmbzn24@gmail.com","author":"kmbzn","message":"update npm"},{"hash":"eccceaaadcd967d6c9ccd932a5897280a0f9ecdf","time":1764081817000,"email":"kmbzn24@gmail.com","author":"kmbzn","message":"Add homework documentation for Software Engineering course, including design pattern analysis and implementation details"},{"hash":"f377a812e180df33ea730c65a8d2dbad7fb4a33e","time":1763946767000,"email":"kmbzn24@gmail.com","author":"kmbzn","message":"Refactor code structure for improved readability and maintainability"}]},"filePathRelative":"cs/10.md"}');export{b as comp,g as data};
