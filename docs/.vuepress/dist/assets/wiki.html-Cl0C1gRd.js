import{_ as o,c as d,a as c,o as l}from"./app-DiAjUdp1.js";const i={};function a(t,e){return l(),d("div",null,[...e[0]||(e[0]=[c('<h1 id="assignment2-2-도서-관리-시스템-구현-wiki" tabindex="-1"><a class="header-anchor" href="#assignment2-2-도서-관리-시스템-구현-wiki"><span>Assignment2-2. 도서 관리 시스템 구현 - wiki</span></a></h1><h3 id="데이터베이스시스템응용-2021024057-김병준" tabindex="-1"><a class="header-anchor" href="#데이터베이스시스템응용-2021024057-김병준"><span>데이터베이스시스템응용: 2021024057 김병준</span></a></h3><p>본 wiki는 도서 관리 시스템 애플리케이션(application)의 주요 기능 구현 사항과, 개발 과정에서 발생한 주요 troubleshooting(troubleshooting) 과정을 포함합니다.</p><h2 id="_1-인증-authentication" tabindex="-1"><a class="header-anchor" href="#_1-인증-authentication"><span>1. 인증 (Authentication)</span></a></h2><ul><li>Controller: <code>controllers/authController.js</code></li></ul><h3 id="_1-1-핵심-기능" tabindex="-1"><a class="header-anchor" href="#_1-1-핵심-기능"><span>1.1. 핵심 기능</span></a></h3><ul><li>회원가입 (<code>postRegister</code>) <ul><li><code>username</code> (ID), <code>password</code>, <code>name</code> (실명), <code>role</code> (user/admin), <code>admin_code</code>를 사용자로부터 입력받습니다.</li><li><code>role</code>이 &#39;admin&#39;일 경우 <code>admin_code</code> (<code>2021024057</code>) 일치 여부를 검증합니다.</li></ul></li><li>비밀번호 암호화: <ul><li>개발의 편의를 위해 <code>salt</code> (솔트) 없이 <code>sha512</code> 알고리즘(algorithm)을 사용하는 단방향 해시(hash) 방식을 채택했습니다. (Node.js 내장 <code>crypto</code> 모듈(module) 사용)</li><li>DB의 <code>password</code> column(column)은 이에 따라 <code>VARCHAR(128)</code>로 구성하였습니다.</li></ul></li><li>로그인 (<code>postLogin</code>) <ul><li><code>username</code>과 <code>password</code>를 받습니다.</li><li>입력된 <code>password</code>를 <code>sha512</code>로 즉시 hashing하여 DB에 저장된 해시값과 비교합니다.</li><li>성공 시 <code>session</code>에 <code>userId</code> (username 값), <code>username</code> (name 값), <code>role</code>을 저장합니다.</li></ul></li><li>로그아웃 (<code>logoutAndGetHomePage</code>) <ul><li><code>req.session.destroy()</code>를 호출하여 세션을 종료합니다.</li></ul></li></ul><h3 id="_1-2-주요-troubleshooting-login의-실패-및-debugging" tabindex="-1"><a class="header-anchor" href="#_1-2-주요-troubleshooting-login의-실패-및-debugging"><span>1.2. 주요 troubleshooting: login의 실패 및 debugging</span></a></h3><ul><li>문제 1: <code>user_id</code>와 <code>pw01</code> (초기 테스트 암호)을 정확히 입력해도 로그인 세션으로 넘어가지 않았습니다.</li><li>과정 1: <code>postLogin</code> 함수에 <code>console.log</code>를 추가하여 입력값(<code>req.body</code>)과 DB 조회 과정을 추적했습니다.</li><li>원인 1: 로그(log) 확인 결과, <code>req.body</code>에 <code>user_id</code>가 아닌 <code>username</code>이 들어오고 있었습니다. (<code>[Debug] 입력된 Body: { username: &#39;kmbzn&#39;, ... }</code>)</li><li>해결 1: 로그인 폼(form) (<code>login.ejs</code>)의 <code>&lt;input&gt;</code> 태그 <code>name</code> 속성(attribute)이 <code>username</code>으로 되어있는 것을 확인하고, 서버 로직(<code>postLogin</code>)이 <code>user_id</code> 대신 <code>username</code>을 받도록 수정했습니다.</li><li>문제 2: <code>Column &#39;user_type&#39; cannot be null</code> 오류가 회원가입 시 발생했습니다.</li><li>원인 2: <code>postRegister</code> 컨트롤러(controller)는 <code>req.body.user_type</code>을 기대했지만, 폼 (<code>register.ejs</code>)의 <code>&lt;select&gt;</code> 태그에 <code>name=&quot;user_type&quot;</code> 속성이 누락되어 서버로 값이 전송되지 않았습니다.</li><li>해결 2: <code>register.ejs</code> 파일의 User Role 드롭다운(dropdown) <code>&lt;select&gt;</code> 태그에 <code>name=&quot;user_type&quot;</code>을 추가하여 문제를 해결했습니다.</li></ul><h2 id="_2-db-schema-변경" tabindex="-1"><a class="header-anchor" href="#_2-db-schema-변경"><span>2. DB schema 변경</span></a></h2><p>개발 초기, 프로그램의 요구사항과 실제 DB 스키마(schema)의 attribute 이름이 불일치하여 다수의 오류가 발생했습니다. 이를 해결하기 위해 DB 스키마를 변경했습니다.</p><ul><li><ol><li><code>USER</code> 테이블의 <code>user_id</code> -&gt; <code>username</code> 변경 (가장 큰 변경점)</li></ol><ul><li>문제: 프로그램은 로그인 ID로 <code>username</code>을 사용하려 했으나, DB의 PK는 <code>user_id</code>였습니다.</li><li>과정: <code>ALTER TABLE USER CHANGE COLUMN user_id username ...</code> 시도 시 <code>ERROR 1068 (Multiple primary key defined)</code> (PK 중복) 및 <code>ERROR 1553 (Cannot drop index &#39;PRIMARY&#39;)</code> (외래 키 참조) 오류가 발생했습니다.</li><li>원인: <code>USER</code> 테이블의 <code>user_id</code> (PK)를 <code>RENTAL</code>과 <code>RESERVATION</code> 테이블이 <code>FOREIGN KEY</code> (외래 키)로 참조하고 있었습니다.</li><li>해결: 11단계 SQL 쿼리(query)를 통해 <code>FOREIGN_KEY_CHECKS=0</code>으로 설정하고, <code>RENTAL</code>과 <code>RESERVATION</code>의 외래 키를 <code>DROP</code>한 뒤, <code>USER</code>의 PK를 <code>DROP</code>하고, 3개 테이블(<code>USER</code>, <code>RENTAL</code>, <code>RESERVATION</code>)의 column명을 <code>RENAME COLUMN</code>으로 변경한 후, PK와 외래 키를 다시 설정하여 스키마를 일치시켰습니다. (<code>postLogin</code>, <code>postRegister</code> 등 모든 관련 코드도 <code>username</code>을 사용하도록 수정했습니다.)</li></ul></li><li><ol start="2"><li><code>USER</code> 테이블의 <code>user_type</code> -&gt; <code>role</code> 변경:</li></ol><ul><li><code>ALTER TABLE USER RENAME COLUMN user_type TO role;</code> 쿼리를 실행하여 <code>role</code>로 명칭을 통일했습니다. (관련 컨트롤러 코드 수정 완료)</li></ul></li><li><ol start="3"><li><code>USER</code> 테이블의 <code>email</code> 삭제 및 <code>student_id</code> 자동화:</li></ol><ul><li>초기 설계 과정에선 사용자 이메일에 대한 저장도 필요할 것으로 판단하여 해당 column을 포함시켰습니다.</li><li><code>ALTER TABLE USER DROP COLUMN email;</code>로 <code>email</code> column을 삭제했습니다.</li><li><code>student_id</code>를 <code>BIGINT NOT NULL AUTO_INCREMENT UNIQUE KEY</code>로 변경하고, <code>AUTO_INCREMENT</code> 시작값을 <code>2025000001</code>로 설정했습니다.</li><li><code>postRegister</code> 함수에서 <code>student_id</code> 관련 로직을 모두 제거하여 DB가 학번을 자동 부여하도록 수정했습니다. (개발 편의를 위해서)</li></ul></li></ul><h2 id="_3-도서-관리-book-management" tabindex="-1"><a class="header-anchor" href="#_3-도서-관리-book-management"><span>3. 도서 관리 (Book Management)</span></a></h2><ul><li>Controller: <code>controllers/bookController.js</code></li></ul><h3 id="_3-1-핵심-기능" tabindex="-1"><a class="header-anchor" href="#_3-1-핵심-기능"><span>3.1. 핵심 기능</span></a></h3><ul><li>도서 목록 (<code>getBooksPage</code>) 도서 정보와 현재 대출 가능 재고(<code>available_quantity</code>) 등을 <code>JOIN</code>하여 조회하며, 검색 및 정렬 기능을 지원합니다.</li><li>도서 대출 (<code>postBorrowBook</code>) 사용자의 연체 여부, 대출 권수(최대 3권), 도서 재고, 중복 대출 여부(동일 <code>book_id</code> 불가)를 검증한 후 <code>RENTAL</code> 테이블에 추가하고 <code>BOOK_COPY</code> 상태를 &#39;on_loan&#39;으로 변경합니다. <ul><li>(이전 수정) 중복 대출 검증 로직을 <code>count &gt; 1</code> (3권부터 불가)에서 <code>count &gt;= 2</code> (2권 보유 시 3권째 불가)로 수정한 바 있습니다.</li></ul></li><li>도서 반납 (<code>postReturnBook</code>) <code>RENTAL</code>의 <code>return_date</code>를 기록하고 <code>BOOK_COPY</code> 상태를 &#39;available&#39;로 변경합니다. 연체 반납 시 사용자의 다른 연체 내역이 없다면 <code>USER</code>의 <code>overdue_status</code>를 <code>FALSE</code>로 업데이트합니다.</li><li>도서 예약 (<code>postReserveBook</code>) <code>getBookInstances</code>로 조회 시 대출 가능 재고가 0일 경우 예약을 받습니다. 사용자의 연체 상태, 현재 대출 여부, 중복 예약 여부를 검증한 후 <code>RESERVATION</code> 테이블에 추가합니다.</li></ul><h3 id="_3-2-주요-troubleshooting-도서-추가-실패" tabindex="-1"><a class="header-anchor" href="#_3-2-주요-troubleshooting-도서-추가-실패"><span>3.2. 주요 troubleshooting: 도서 추가 실패</span></a></h3><ul><li>문제 1: <code>Error: Column &#39;author&#39; cannot be null</code> 오류가 발생했습니다.</li><li>원인 1: <code>add-book.ejs</code> 폼의 <code>&lt;select&gt;</code> 태그 <code>name</code> 속성이 <code>authors</code> (복수형)로 되어있었으나, <code>postAddBook</code> 컨트롤러는 <code>req.body.author</code> (단수형)를 참조하고 있었습니다.</li><li>해결 1: <code>add-book.ejs</code>의 <code>name=&quot;authors&quot;</code>를 <code>name=&quot;author&quot;</code>로 수정하여 변수명을 일치시켰습니다.</li><li>문제 2: <code>Error: Incorrect integer value: &#39;id:5&#39; for column &#39;category_id&#39;</code> 오류가 발생했습니다.</li><li>원인 2: <code>Choices.js</code> 라이브러리(library)가 기존 항목 선택 시 <code>&#39;id:5&#39;</code> (문자열)를, 새 항목 입력 시 <code>&#39;New Category&#39;</code> (문자열)를 <code>value</code>로 전송했습니다. <code>postAddBook</code> 함수는 이 문자열을 파싱(parsing)하지 않고 <code>INT</code> 타입의 <code>category_id</code> column에 <code>INSERT</code>하려 했습니다.</li><li>해결 2: <code>postAddBook</code> 함수 내부에 <code>getOrCreateAuthorId</code>와 <code>getOrCreateCategoryId</code> 헬퍼 함수를 구현했습니다. 이 함수들은 <code>value</code>가 <code>&#39;id:&#39;</code>로 시작하면 숫자를 파싱하고, 일반 문자열이면 DB에서 검색하거나 새로 <code>INSERT</code>하여 유효한 <code>ID</code> 값을 반환하도록 로직을 수정하여 해결했습니다.</li></ul><h2 id="_4-사용자-및-카테고리-admin" tabindex="-1"><a class="header-anchor" href="#_4-사용자-및-카테고리-admin"><span>4. 사용자 및 카테고리 (admin)</span></a></h2><ul><li>Controllers: <code>controllers/userController.js</code>, <code>controllers/categoryController.js</code></li><li>사용자 관리 (<code>getUsersPage</code>) <code>USER</code> 테이블을 조회하며, <code>username</code>, <code>name</code>, <code>role</code> 기준의 동적 검색 기능을 구현했습니다.</li><li>카테고리 관리 (<code>postDeleteCategory</code>) 카테고리 삭제 시, <code>BOOK_CATEGORY</code> 테이블에서 해당 <code>category_id</code>를 참조하는 레코드를 먼저 <code>DELETE</code>하여 외래 키 제약 조건 오류를 방지한 후, <code>CATEGORY</code>에서 원본을 삭제합니다. (트랜잭션 처리)</li></ul><h2 id="_5-demo-youtube-영상-link-첨부" tabindex="-1"><a class="header-anchor" href="#_5-demo-youtube-영상-link-첨부"><span>5. [Demo] YouTube 영상 link 첨부</span></a></h2><p><a href="https://youtu.be/rEnQjFZ19rk?si=n0fbnothZE7vTcBF" target="_blank" rel="noopener noreferrer">https://youtu.be/rEnQjFZ19rk?si=n0fbnothZE7vTcBF</a></p>',22)])])}const r=o(i,[["render",a]]),s=JSON.parse('{"path":"/db/wiki.html","title":"Assignment2-2. 도서 관리 시스템 구현 - wiki","lang":"ko-KR","frontmatter":{},"git":{"updatedTime":1761263576000,"contributors":[{"name":"kmbzn","username":"kmbzn","email":"kmbzn24@gmail.com","commits":2,"url":"https://github.com/kmbzn"}],"changelog":[{"hash":"31dabd91062ae4097bbcb6f7bebeb609ae905ae8","time":1761263576000,"email":"kmbzn24@gmail.com","author":"kmbzn","message":"위키 문서 수정: 데이터베이스 시스템 응용 제목 형식 변경 및 데모 영상 링크 추가"},{"hash":"8600b20ab0a31871d0a8ab1f33077cca06e672d9","time":1761260557000,"email":"kmbzn24@gmail.com","author":"kmbzn","message":"위키 문서 추가: 도서 관리 시스템 구현 및 인증 기능에 대한 상세 설명 포함"}]},"filePathRelative":"db/wiki.md"}');export{r as comp,s as data};
