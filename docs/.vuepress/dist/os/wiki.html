<!doctype html>
<html lang="ko-KR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><meta property="og:description" content="KeyBaseZone"><meta property="og:image" content="https://kmbzn.com/images/og.png"><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/android-chrome-192x192.png"><link rel="icon" type="image/png" sizes="512x512" href="/images/android-chrome-512x512.png"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/victor-mono@latest/dist/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.css"><title>Project 02: xv6 RISC-V Kernel-Level Threads Implementation - wiki</title><meta name="description" content="Summarizing key concepts from CS lectures.">
    <link rel="preload" href="/assets/style-Cu47Lw8E.css" as="style"><link rel="stylesheet" href="/assets/style-Cu47Lw8E.css">
    <link rel="modulepreload" href="/assets/app-DiAjUdp1.js"><link rel="modulepreload" href="/assets/wiki.html-7cS_CimX.js">
    <link rel="prefetch" href="/assets/Mindscape.html-C9WauGdL.js" as="script"><link rel="prefetch" href="/assets/Musics.html-CSwkfQax.js" as="script"><link rel="prefetch" href="/assets/index.html-DKb7sVl0.js" as="script"><link rel="prefetch" href="/assets/hjangkim.html-Ci1Wc-uR.js" as="script"><link rel="prefetch" href="/assets/test.html-DbYfagzl.js" as="script"><link rel="prefetch" href="/assets/1-Linear-Algebra.html-DlRluxiq.js" as="script"><link rel="prefetch" href="/assets/10-Machine-Learning-1.html-3NVrHd8D.js" as="script"><link rel="prefetch" href="/assets/11-Machine-Learning-2.html-BrNp_fWh.js" as="script"><link rel="prefetch" href="/assets/12-Machine-Learning-3.html-Dw77aZ2-.js" as="script"><link rel="prefetch" href="/assets/13-Linear-Models.html-Cpg4UNdy.js" as="script"><link rel="prefetch" href="/assets/14-Other-Classic-ML-Models.html-DwoJcK9U.js" as="script"><link rel="prefetch" href="/assets/15-Deep-Learning-1.html-fc0qM01H.js" as="script"><link rel="prefetch" href="/assets/16-Deep-Learning-2.html-BCic-zcH.js" as="script"><link rel="prefetch" href="/assets/2-Linear-Algebra-Search.html-Dc_akdS5.js" as="script"><link rel="prefetch" href="/assets/3-Search.html-CcFH0cUF.js" as="script"><link rel="prefetch" href="/assets/4-Knowledge-Logic-1.html-BG3Mt4xo.js" as="script"><link rel="prefetch" href="/assets/5-Knowledge-Logic-2.html-KmTkk9jc.js" as="script"><link rel="prefetch" href="/assets/6-Probability.html-DhV5Uv2F.js" as="script"><link rel="prefetch" href="/assets/7-Information-Theory.html-CwrMTZEq.js" as="script"><link rel="prefetch" href="/assets/8-Probabilistic-Reasoning-2.html-Ii3AzpB2.js" as="script"><link rel="prefetch" href="/assets/9-Probabilistic-Reasoning-3.html-CR193qU_.js" as="script"><link rel="prefetch" href="/assets/midterm.html-tgjJNv_-.js" as="script"><link rel="prefetch" href="/assets/1-Course-Intro.html-CgxxM114.js" as="script"><link rel="prefetch" href="/assets/10-Character-Animation.html-FqEOi_sD.js" as="script"><link rel="prefetch" href="/assets/11-Curves.html-BJs4hxkl.js" as="script"><link rel="prefetch" href="/assets/12-More-Lighting-Texture.html-CK9sI5Uw.js" as="script"><link rel="prefetch" href="/assets/2-Rendering-Basics.html-OWDXF3IE.js" as="script"><link rel="prefetch" href="/assets/3-Transformations.html-BviEOqsU.js" as="script"><link rel="prefetch" href="/assets/4-Affine-Space-Frame_Matrix.html-Dk3kzPnP.js" as="script"><link rel="prefetch" href="/assets/5-Vertex-Processing-1.html-BxvpE6no.js" as="script"><link rel="prefetch" href="/assets/6-Vertex-Processing-2.html-Btg7Ewr5.js" as="script"><link rel="prefetch" href="/assets/7-Hierachical-Modeling-Mesh.html-DoAk0yw2.js" as="script"><link rel="prefetch" href="/assets/8-Lighting.html-D7E0gAWZ.js" as="script"><link rel="prefetch" href="/assets/9-Orientation-Rotation.html-B5rDwM22.js" as="script"><link rel="prefetch" href="/assets/Project-2.html-DATuTqu8.js" as="script"><link rel="prefetch" href="/assets/Project-3.html-Cb1HrirP.js" as="script"><link rel="prefetch" href="/assets/01.Overview.html-BMmnhxqX.js" as="script"><link rel="prefetch" href="/assets/02.ë³´ì•ˆì •ì±….html-BvfYymd4.js" as="script"><link rel="prefetch" href="/assets/03.Cryptographic_Tools.html-CpAov9pP.js" as="script"><link rel="prefetch" href="/assets/04.User_Authentification.html-EZ61n9Wp.js" as="script"><link rel="prefetch" href="/assets/05.Access_Control.html-DSkiQ033.js" as="script"><link rel="prefetch" href="/assets/06.DB_Security.html-B5J-0t9F.js" as="script"><link rel="prefetch" href="/assets/07.Malware.html-dF65u_N4.js" as="script"><link rel="prefetch" href="/assets/08.Firmware_Analysis.html-C1E5CMRg.js" as="script"><link rel="prefetch" href="/assets/24midterm.html-By5qTLKM.js" as="script"><link rel="prefetch" href="/assets/1.Introduction.html-C47g-y4Z.js" as="script"><link rel="prefetch" href="/assets/13.Data_Storage_Structures.html-YI5wMh9h.js" as="script"><link rel="prefetch" href="/assets/14.Indexing.html-DhcN19Np.js" as="script"><link rel="prefetch" href="/assets/15.Query_Processing.html-BDgud-Uk.js" as="script"><link rel="prefetch" href="/assets/16.Query_Optimization.html-Bzuz-PAz.js" as="script"><link rel="prefetch" href="/assets/2.Relational.html-FGxvg1Tt.js" as="script"><link rel="prefetch" href="/assets/2021024057.html-BM1iDF28.js" as="script"><link rel="prefetch" href="/assets/3.SQL-1.html-DzrCINDA.js" as="script"><link rel="prefetch" href="/assets/6.E-R_Model.html-BvOeHUqp.js" as="script"><link rel="prefetch" href="/assets/7.Relational_Database_Design-1.html-DsLJNR0F.js" as="script"><link rel="prefetch" href="/assets/7.Relational_Database_Design-2.html-8q-MR0pl.js" as="script"><link rel="prefetch" href="/assets/Assignment2-1.html-DTGNv6wG.js" as="script"><link rel="prefetch" href="/assets/Assignment2-2.html-Bq9XJWGA.js" as="script"><link rel="prefetch" href="/assets/Assignment3.html-7MnFNlB3.js" as="script"><link rel="prefetch" href="/assets/LAB06.html-DqujdcEz.js" as="script"><link rel="prefetch" href="/assets/LAB08.html-DDx6PlJW.js" as="script"><link rel="prefetch" href="/assets/wiki.html-Cl0C1gRd.js" as="script"><link rel="prefetch" href="/assets/Bitcoin.html-whayWvy8.js" as="script"><link rel="prefetch" href="/assets/4.html-P_Nu2ThJ.js" as="script"><link rel="prefetch" href="/assets/5.html-CVmgft97.js" as="script"><link rel="prefetch" href="/assets/6.html-s0ho8XGk.js" as="script"><link rel="prefetch" href="/assets/7.html-CIqjZWkw.js" as="script"><link rel="prefetch" href="/assets/8.html-ekcKxKq5.js" as="script"><link rel="prefetch" href="/assets/saja.html-DPf3O_Nu.js" as="script"><link rel="prefetch" href="/assets/1018.html-BQ-z8N47.js" as="script"><link rel="prefetch" href="/assets/1966.html-Xtj-P-rg.js" as="script"><link rel="prefetch" href="/assets/PythonTimeout.html-32FYlrhy.js" as="script"><link rel="prefetch" href="/assets/aloha_6.html-BJ52mT6c.js" as="script"><link rel="prefetch" href="/assets/std-vector.html-Cds37cso.js" as="script"><link rel="prefetch" href="/assets/vim.html-BZOtA-08.js" as="script"><link rel="prefetch" href="/assets/Nordvik.html-BKiS8sNn.js" as="script"><link rel="prefetch" href="/assets/NorthSentinelIsland.html-CYLutt5T.js" as="script"><link rel="prefetch" href="/assets/Rongorongo.html-DnmHm8rK.js" as="script"><link rel="prefetch" href="/assets/10.VirtualMemory-1.html-Du8ODbvd.js" as="script"><link rel="prefetch" href="/assets/11.VirtualMemory-2.html-jb4YIPal.js" as="script"><link rel="prefetch" href="/assets/12.FileSystem.html-csAKoeSH.js" as="script"><link rel="prefetch" href="/assets/13.MassStorageManagement.html-OVXnSSu3.js" as="script"><link rel="prefetch" href="/assets/14.IOSystems.html-zfnrgjW5.js" as="script"><link rel="prefetch" href="/assets/7.Deadlocks.html-CSbDHus2.js" as="script"><link rel="prefetch" href="/assets/8.MemoryManagement-1.html-C0Bcopl7.js" as="script"><link rel="prefetch" href="/assets/9.MemoryManagement-2.html-GfQ2p-yS.js" as="script"><link rel="prefetch" href="/assets/Project-2-test-code.html-CwL7a5G9.js" as="script"><link rel="prefetch" href="/assets/Project-2.html-DUYz5cwt.js" as="script"><link rel="prefetch" href="/assets/Project-3-ko.html-D0BN2WIs.js" as="script"><link rel="prefetch" href="/assets/Project-3-wiki.html-cOCGYCjN.js" as="script"><link rel="prefetch" href="/assets/Project-3.html-BQZcbwO0.js" as="script"><link rel="prefetch" href="/assets/13-FPL(1).html-DI5cW3--.js" as="script"><link rel="prefetch" href="/assets/10-Object-Oriented-Analysis.html-DWBHAb9u.js" as="script"><link rel="prefetch" href="/assets/11-Object-Oriented-Design.html-CfQ4rA9N.js" as="script"><link rel="prefetch" href="/assets/12-DesignPatterns.html-BRu6hDTD.js" as="script"><link rel="prefetch" href="/assets/13-Intro-To-QA-Testing.html-BrmZp5bv.js" as="script"><link rel="prefetch" href="/assets/2-IntroToSE.html-CQ_5M2M5.js" as="script"><link rel="prefetch" href="/assets/3-Process.html-CqSiUKDS.js" as="script"><link rel="prefetch" href="/assets/4-ProcessModels.html-1lWy2nxL.js" as="script"><link rel="prefetch" href="/assets/5-Agile.html-K5aSVwOP.js" as="script"><link rel="prefetch" href="/assets/6-Requirements.html-mTbosVen.js" as="script"><link rel="prefetch" href="/assets/7-Requirements-2.html-DQKJ6bh1.js" as="script"><link rel="prefetch" href="/assets/8-Architecture.html-DHdirk5u.js" as="script"><link rel="prefetch" href="/assets/9-UML.html-3GmiHwkb.js" as="script"><link rel="prefetch" href="/assets/ExtraVirginOliveOil.html-CrCWLJtU.js" as="script"><link rel="prefetch" href="/assets/PsylliumHusk.html-UsHkd0EM.js" as="script"><link rel="prefetch" href="/assets/404.html-BnHiKzmD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/images/kbz.png" alt><!----></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><!----><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><ul class="vp-sidebar-children" style=""><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/Mindscape.html" aria-label="Mindscape ğŸ”¥"><!--[--><!--[--><!--]--><!--]-->Mindscape ğŸ”¥<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/Musics.html" aria-label="Playlist ğŸ§"><!--[--><!--[--><!--]--><!--]-->Playlist ğŸ§<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">ğŸ¤– Artifical Intelligence <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/ai/1-Linear-Algebra.html" aria-label="1. Basics; Linear Algebra"><!--[--><!--[--><!--]--><!--]-->1. Basics; Linear Algebra<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/2-Linear-Algebra-Search.html" aria-label="2. Basics; Linear Algebra (2), Search (1)"><!--[--><!--[--><!--]--><!--]-->2. Basics; Linear Algebra (2), Search (1)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/3-Search.html" aria-label="3. Search (2)"><!--[--><!--[--><!--]--><!--]-->3. Search (2)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/4-Knowledge-Logic-1.html" aria-label="4. Knowledge and Logic (1)"><!--[--><!--[--><!--]--><!--]-->4. Knowledge and Logic (1)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/5-Knowledge-Logic-2.html" aria-label="5. Knowledge and Logic (2)"><!--[--><!--[--><!--]--><!--]-->5. Knowledge and Logic (2)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/6-Probability.html" aria-label="6. Probability"><!--[--><!--[--><!--]--><!--]-->6. Probability<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/7-Information-Theory.html" aria-label="7. Information Theory"><!--[--><!--[--><!--]--><!--]-->7. Information Theory<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/8-Probabilistic-Reasoning-2.html" aria-label="8. Probabilitc Reasoning (2)"><!--[--><!--[--><!--]--><!--]-->8. Probabilitc Reasoning (2)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/9-Probabilistic-Reasoning-3.html" aria-label="9. Probabilitc Reasoning (3)"><!--[--><!--[--><!--]--><!--]-->9. Probabilitc Reasoning (3)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/10-Machine-Learning-1.html" aria-label="10. Machine Learning (1)"><!--[--><!--[--><!--]--><!--]-->10. Machine Learning (1)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/11-Machine-Learning-2.html" aria-label="11. Machine Learning (2)"><!--[--><!--[--><!--]--><!--]-->11. Machine Learning (2)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/12-Machine-Learning-3.html" aria-label="12. Machine Learning (3)"><!--[--><!--[--><!--]--><!--]-->12. Machine Learning (3)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/13-Linear-Models.html" aria-label="13. Linear Models"><!--[--><!--[--><!--]--><!--]-->13. Linear Models<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/14-Other-Classic-ML-Models.html" aria-label="14. Other Classic ML Models (1)"><!--[--><!--[--><!--]--><!--]-->14. Other Classic ML Models (1)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/15-Deep-Learning-1.html" aria-label="15. Other Classic ML Models (2)"><!--[--><!--[--><!--]--><!--]-->15. Other Classic ML Models (2)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/ai/16-Deep-Learning-2.html" aria-label="16. Neural Networks and Deep Learning (2)"><!--[--><!--[--><!--]--><!--]-->16. Neural Networks and Deep Learning (2)<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">ğŸ”’ Computer Security <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/cs/01.Overview.html" aria-label="01. Overview"><!--[--><!--[--><!--]--><!--]-->01. Overview<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cs/02.%EB%B3%B4%EC%95%88%EC%A0%95%EC%B1%85.html" aria-label="02. ì •ë³´ë³´ì•ˆì •ì±… ë° ë²•ê·œ"><!--[--><!--[--><!--]--><!--]-->02. ì •ë³´ë³´ì•ˆì •ì±… ë° ë²•ê·œ<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cs/03.Cryptographic_Tools.html" aria-label="03. Cryptographic Tools"><!--[--><!--[--><!--]--><!--]-->03. Cryptographic Tools<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cs/04.User_Authentification.html" aria-label="04. User Authentication"><!--[--><!--[--><!--]--><!--]-->04. User Authentication<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cs/05.Access_Control.html" aria-label="05. Access Control"><!--[--><!--[--><!--]--><!--]-->05. Access Control<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cs/06.DB_Security.html" aria-label="06. Database Security"><!--[--><!--[--><!--]--><!--]-->06. Database Security<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cs/07.Malware.html" aria-label="07. Malicious Software"><!--[--><!--[--><!--]--><!--]-->07. Malicious Software<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/cs/08.Firmware_Analysis.html" aria-label="08. Firmware Analysis"><!--[--><!--[--><!--]--><!--]-->08. Firmware Analysis<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">ğŸ—„ï¸ Database System <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/db/1.Introduction.html" aria-label="1. Introduction"><!--[--><!--[--><!--]--><!--]-->1. Introduction<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/db/2.Relational.html" aria-label="2. Relational Model"><!--[--><!--[--><!--]--><!--]-->2. Relational Model<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/db/3.SQL-1.html" aria-label="3. SQL"><!--[--><!--[--><!--]--><!--]-->3. SQL<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/db/6.E-R_Model.html" aria-label="6. E-R Model"><!--[--><!--[--><!--]--><!--]-->6. E-R Model<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/db/7.Relational_Database_Design-1.html" aria-label="7. Relational Database Design (1)"><!--[--><!--[--><!--]--><!--]-->7. Relational Database Design (1)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/db/7.Relational_Database_Design-2.html" aria-label="7. Relational Database Design (2)"><!--[--><!--[--><!--]--><!--]-->7. Relational Database Design (2)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/db/13.Data_Storage_Structures.html" aria-label="13. Data Storage Structures"><!--[--><!--[--><!--]--><!--]-->13. Data Storage Structures<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/db/14.Indexing.html" aria-label="14. Indexing"><!--[--><!--[--><!--]--><!--]-->14. Indexing<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/db/15.Query_Processing.html" aria-label="15. Query Processing"><!--[--><!--[--><!--]--><!--]-->15. Query Processing<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">ğŸ“ Software Engineering <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/se/2-IntroToSE.html" aria-label="2. Introduction to Software Engineering"><!--[--><!--[--><!--]--><!--]-->2. Introduction to Software Engineering<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/3-Process.html" aria-label="3. Process"><!--[--><!--[--><!--]--><!--]-->3. Process<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/4-ProcessModels.html" aria-label="4. Process Models"><!--[--><!--[--><!--]--><!--]-->4. Process Models<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/5-Agile.html" aria-label="5. Agile"><!--[--><!--[--><!--]--><!--]-->5. Agile<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/6-Requirements.html" aria-label="6. Requirements"><!--[--><!--[--><!--]--><!--]-->6. Requirements<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/7-Requirements-2.html" aria-label="7. Requirements Elicitation and Documentation"><!--[--><!--[--><!--]--><!--]-->7. Requirements Elicitation and Documentation<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/8-Architecture.html" aria-label="8. Architecture"><!--[--><!--[--><!--]--><!--]-->8. Architecture<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/9-UML.html" aria-label="9. Unified Modelling Language"><!--[--><!--[--><!--]--><!--]-->9. Unified Modelling Language<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/10-Object-Oriented-Analysis.html" aria-label="10. Object-Oriented Analysis"><!--[--><!--[--><!--]--><!--]-->10. Object-Oriented Analysis<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/11-Object-Oriented-Design.html" aria-label="11. Object-Oriented Design"><!--[--><!--[--><!--]--><!--]-->11. Object-Oriented Design<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/12-DesignPatterns.html" aria-label="12. Design Patterns"><!--[--><!--[--><!--]--><!--]-->12. Design Patterns<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/se/13-Intro-To-QA-Testing.html" aria-label="13. Intro to QA Testing"><!--[--><!--[--><!--]--><!--]-->13. Intro to QA Testing<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">ğŸ§  Algorithm <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/algorithm/PythonTimeout.html" aria-label="Python ì‹œê°„ ì´ˆê³¼ ë°©ì§€ë¥¼ ìœ„í•œ íŒ"><!--[--><!--[--><!--]--><!--]-->Python ì‹œê°„ ì´ˆê³¼ ë°©ì§€ë¥¼ ìœ„í•œ íŒ<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/algorithm/std-vector.html" aria-label="C++ std::vector ì‚¬ìš©ë²• ì •ë¦¬"><!--[--><!--[--><!--]--><!--]-->C++ std::vector ì‚¬ìš©ë²• ì •ë¦¬<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/algorithm/vim.html" aria-label="Vim ì‚¬ìš© ë§¤ë‰´ì–¼"><!--[--><!--[--><!--]--><!--]-->Vim ì‚¬ìš© ë§¤ë‰´ì–¼<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/algorithm/1018.html" aria-label="1018ë²ˆ: ì²´ìŠ¤íŒ ë‹¤ì‹œ ì¹ í•˜ê¸°"><!--[--><!--[--><!--]--><!--]-->1018ë²ˆ: ì²´ìŠ¤íŒ ë‹¤ì‹œ ì¹ í•˜ê¸°<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/algorithm/1966.html" aria-label="1966ë²ˆ: í”„ë¦°í„° í"><!--[--><!--[--><!--]--><!--]-->1966ë²ˆ: í”„ë¦°í„° í<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page" data-v-e24f0054><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="project-02-xv6-risc-v-kernel-level-threads-implementation-wiki" tabindex="-1"><a class="header-anchor" href="#project-02-xv6-risc-v-kernel-level-threads-implementation-wiki"><span>Project 02: xv6 RISC-V Kernel-Level Threads Implementation - wiki</span></a></h1><h2 id="design" tabindex="-1"><a class="header-anchor" href="#design"><span>Design</span></a></h2><h3 id="project-overview" tabindex="-1"><a class="header-anchor" href="#project-overview"><span>Project Overview</span></a></h3><p>ë³¸ projectì˜ í•µì‹¬ ëª©í‘œëŠ” xv6 RISC-V ê¸°ë°˜ ìš´ì˜ì²´ì œì— <strong>kernel-level thread</strong> (ì»¤ë„ ìˆ˜ì¤€ thread) ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì´ë‹¤. xv6ëŠ” MITì—ì„œ êµìœ¡ ëª©ì ìœ¼ë¡œ ì„¤ê³„í•œ ê°„ê²°í•œ UNIX ê¸°ë°˜ OSë¡œ, ë‹¤ì¤‘ í”„ë¡œì„¸ìŠ¤(multiprocessing)ëŠ” ì§€ì›í•˜ì§€ë§Œ ë‹¤ì¤‘ ìŠ¤ë ˆë“œ(multithreading)ëŠ” ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. ë³¸ projectëŠ” <strong>ê¸°ì¡´ xv6ì˜ process ê´€ë¦¬ êµ¬ì¡°ë¥¼ ìµœëŒ€í•œ í™œìš©í•˜ë©´ì„œ</strong>, threadì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸(context), ìì› ê³µìœ  ë°©ì‹, ë™ê¸°í™” ì‹œë‚˜ë¦¬ì˜¤ ë“±ì„ êµ¬í˜„í•˜ëŠ” ë° ì¤‘ì ì„ ë‘”ë‹¤.</p><p>ThreadëŠ” processì™€ ë‹¬ë¦¬ ì£¼ì†Œ ê³µê°„ì„ ê³µìœ í•˜ë©°, ì‚¬ìš©ì ìˆ˜ì¤€ stackê³¼ registerë§Œ ë…ë¦½ì ì´ë‹¤. ë”°ë¼ì„œ xv6ì˜ <code>proc</code> êµ¬ì¡°ì²´ë¥¼ ê·¸ëŒ€ë¡œ ì¬í™œìš©í•˜ë˜, thread ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” flag <code>is_thread</code>ë¥¼ ìƒˆë¡­ê²Œ ì¶”ê°€í•˜ê³ , ê·¸ì— ë”°ë¼ <code>clone()</code>, <code>join()</code>, <code>exec()</code>, <code>kill()</code>, <code>sleep()</code>, <code>wakeup()</code> ë“±ì˜ ë™ì‘ì„ ìˆ˜ì •í•˜ì˜€ë‹¤.</p><h3 id="design-principles-and-requirements-strategy" tabindex="-1"><a class="header-anchor" href="#design-principles-and-requirements-strategy"><span>Design Principles and Requirements Strategy</span></a></h3><h4 id="_1-address-space-sharing-pagetable" tabindex="-1"><a class="header-anchor" href="#_1-address-space-sharing-pagetable"><span>1. Address Space Sharing (<code>pagetable</code>)</span></a></h4><p>Threadì˜ ë³¸ì§ˆì€ <strong>í•˜ë‚˜ì˜ ì£¼ì†Œ ê³µê°„ì„ ê³µìœ í•˜ëŠ” ë‹¤ì¤‘ ì‹¤í–‰ ê²½ë¡œ</strong>ì´ë‹¤. ë”°ë¼ì„œ <code>clone()</code>ìœ¼ë¡œ ìƒˆ threadë¥¼ ìƒì„±í•  ë•Œì—ëŠ” <code>fork()</code>ì²˜ëŸ¼ ìƒˆë¡œìš´ <code>pagetable</code>ì„ ë³µì‚¬í•´ì„œëŠ” ì•ˆ ë˜ê³ , ê¸°ì¡´ processì˜ pagetableì„ <strong>ê³µìœ </strong>í•´ì•¼ í•œë‹¤. ë‹¨, trapframeê³¼ contextëŠ” threadë§ˆë‹¤ ê°œë³„ì ìœ¼ë¡œ ê°€ì ¸ì•¼ í•˜ë¯€ë¡œ <code>allocproc()</code>ì„ í†µí•´ ìƒˆë¡œìš´ <code>proc</code>ì„ í• ë‹¹í•œë‹¤.</p><p><strong>ë³€ê²½ ì‚¬í•­</strong></p><ul><li><code>uvmshare()</code> í•¨ìˆ˜ë¥¼ ì§ì ‘ êµ¬í˜„í•˜ì—¬, ë¶€ëª¨ì˜ user PTEë¥¼ ìì‹ pagetableì— ì§ì ‘ ë§¤í•‘í•¨.</li><li><code>clone()</code>ì—ì„œ <code>np-&gt;pagetable = proc_pagetable(np);</code> í›„ <code>uvmshare(np-&gt;pagetable, p-&gt;pagetable, p-&gt;sz);</code> í˜¸ì¶œ</li></ul><h4 id="_2-user-stack-separation" tabindex="-1"><a class="header-anchor" href="#_2-user-stack-separation"><span>2. User Stack Separation</span></a></h4><p>ê° threadëŠ” ë…ë¦½ëœ ì‚¬ìš©ì stackì„ í•„ìš”ë¡œ í•œë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ì ì˜ì—­ì—ì„œ <code>thread_create()</code>ê°€ í˜¸ì¶œë˜ë©´, <code>sbrk(PGSIZE)</code>ë¡œ 1page ë‹¨ìœ„ì˜ stack memoryë¥¼ í• ë‹¹í•˜ê³ , í•´ë‹¹ ì£¼ì†Œë¥¼ <code>clone()</code>ì— ì¸ìë¡œ ì „ë‹¬í•´ì•¼ í•œë‹¤. kernelì—ì„œëŠ” <code>trapframe-&gt;sp</code>ë¥¼ í•´ë‹¹ ì£¼ì†Œì˜ top(<code>+PGSIZE</code>)ë¡œ ì„¤ì •í•˜ì—¬ ì‹¤í–‰ì„ ê°œì‹œí•œë‹¤.</p><p><strong>ë³€ê²½ ì‚¬í•­</strong></p><ul><li><code>thread_create()</code>ì—ì„œ page-aligned stackì„ í™•ë³´ (<code>s = sbrk(PGSIZE)</code>), ì‹¤íŒ¨ ì‹œ -1 ë°˜í™˜</li><li><code>clone()</code> ë‚´ì—ì„œ stack ìœ íš¨ì„± ê²€ì¦: null ì²´í¬, page-alignment í™•ì¸, <code>walkaddr()</code>ë¡œ ë¬¼ë¦¬ ì£¼ì†Œ ê²€ì¦</li></ul><h4 id="_3-function-pointer-based-thread-entry-point" tabindex="-1"><a class="header-anchor" href="#_3-function-pointer-based-thread-entry-point"><span>3. Function Pointer-Based Thread Entry Point</span></a></h4><p>xv6ì—ì„œëŠ” ìœ ì € í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ì§ì ‘ trapframeì— ì„¤ì •í•˜ì—¬ ì§„ì…ì ì„ ì œê³µí•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ <code>clone()</code>ì—ì„œ <code>np-&gt;trapframe-&gt;epc = (uint64)fcn;</code>ìœ¼ë¡œ fcnì„ ì„¤ì •í•˜ê³ , arg1ê³¼ arg2ëŠ” ê°ê° <code>a0</code>, <code>a1</code> registerì— ì„¸íŒ…í•œë‹¤. ì´ë¡œì¨ ìƒˆë¡œ ìƒì„±ëœ threadëŠ” <code>usertrapret()</code> ì´í›„ í•´ë‹¹ í•¨ìˆ˜ë¡œ jumpí•˜ê²Œ ëœë‹¤.</p><p><strong>íŠ¹ì´ì </strong></p><ul><li>ë³¸ ê³¼ì œì—ì„œëŠ” <code>fcn == 0x0</code> ì¸ ê²½ìš°ê°€ ì •ìƒì ì´ë©°, ê³¼ì œ ëª…ì„¸ì—ì„œ ì œê³µí•œ í…ŒìŠ¤íŠ¸ê°€ ì´ë¥¼ ê°•ì œì ìœ¼ë¡œ ì„¤ì •í•´ë‘ì—ˆìŒ â†’ ë¬´íš¨ ì£¼ì†Œê°€ ì•„ë‹˜</li><li>ë”°ë¼ì„œ <code>fcn == 0</code>ì¼ ê²½ìš° ì˜ˆì™¸ ì²˜ë¦¬í•˜ì§€ ì•Šë„ë¡ í•¨</li></ul><h4 id="_4-thread-identification-is-thread" tabindex="-1"><a class="header-anchor" href="#_4-thread-identification-is-thread"><span>4. Thread Identification (<code>is_thread</code>)</span></a></h4><p>processì™€ threadë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ <code>proc</code> êµ¬ì¡°ì²´ì— <code>is_thread</code> flagë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤. ì´ë¥¼ í†µí•´ <code>join()</code>, <code>exec()</code>, <code>kill()</code> ë“±ì—ì„œ ì¡°ê±´ ë¶„ê¸°ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.</p><p><strong>ì ìš© ìœ„ì¹˜</strong></p><ul><li><code>clone()</code>ì—ì„œëŠ” <code>np-&gt;is_thread = 1;</code></li><li><code>fork()</code>ì—ì„œëŠ” <code>np-&gt;is_thread = 0;</code>ë¡œ ëª…ì‹œì ìœ¼ë¡œ ì´ˆê¸°í™”</li></ul><h4 id="_5-stack-address-reclamation-on-exit" tabindex="-1"><a class="header-anchor" href="#_5-stack-address-reclamation-on-exit"><span>5. Stack Address Reclamation on Exit</span></a></h4><p>threadê°€ ì¢…ë£Œë˜ë©´, ê·¸ threadê°€ ì‚¬ìš©í•˜ë˜ stackì€ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, <code>join()</code> ì‹œ í•´ë‹¹ ì£¼ì†Œë¥¼ userì—ê²Œ ë„˜ê²¨ <code>sbrk(-PGSIZE)</code>ë¡œ memoryë¥¼ ë°˜ë‚©í•´ì•¼ í•œë‹¤.</p><p><strong>êµ¬í˜„ ë°©ì‹</strong></p><ul><li><code>clone()</code> ì‹œ <code>np-&gt;ustack = (uint64)stack;</code>ìœ¼ë¡œ ì €ì¥</li><li><code>join()</code> ì‹œ <code>copyout()</code>ì„ í†µí•´ user stack ì£¼ì†Œ ì „ë‹¬</li><li><code>thread_join()</code>ì—ì„œ <code>sbrk(-PGSIZE)</code>ë¡œ íšŒìˆ˜</li></ul><h4 id="_6-remove-all-threads-on-exec" tabindex="-1"><a class="header-anchor" href="#_6-remove-all-threads-on-exec"><span>6. Remove All Threads on <code>exec()</code></span></a></h4><p><code>exec()</code>ëŠ” í•´ë‹¹ processì˜ pagetableì„ ì™„ì „íˆ ë®ì–´ì”Œìš°ëŠ” ì‘ì—…ì´ë‹¤. ë”°ë¼ì„œ ê°™ì€ pagetableì„ ê³µìœ í•˜ëŠ” ë‹¤ë¥¸ threadë“¤ë„ ëª¨ë‘ ì œê±°í•˜ì§€ ì•Šìœ¼ë©´ memory corruptionì´ ë°œìƒí•œë‹¤.</p><p><strong>í•´ê²° ë°©ì‹</strong></p><ul><li><code>exec()</code> ì§„ì… ì‹œ, <code>proc[NPROC]</code>ì„ ìˆœíšŒí•˜ë©° <code>pagetable == p-&gt;pagetable &amp;&amp; p != self</code>ì¸ ëª¨ë“  procì— ëŒ€í•´ <code>freeproc()</code> í˜¸ì¶œ</li><li>ì´í›„ ìƒˆë¡œìš´ pagetableì„ <code>proc_pagetable()</code>ë¡œ ì¬ìƒì„±í•˜ê³ , ELF ë°”ì´ë„ˆë¦¬ ë¡œë“œ ìˆ˜í–‰</li></ul><h4 id="_7-terminate-all-threads-on-kill" tabindex="-1"><a class="header-anchor" href="#_7-terminate-all-threads-on-kill"><span>7. Terminate All Threads on <code>kill()</code></span></a></h4><p>RISC-Vì—ì„œëŠ” processë¥¼ ì£½ì´ê¸° ìœ„í•´ì„  ê·¸ ì£¼ì†Œ ê³µê°„ì„ ê³µìœ í•˜ëŠ” ëª¨ë“  threadë¥¼ ì¢…ë£Œì‹œì¼œì•¼ í•œë‹¤. ë”°ë¼ì„œ <code>kill(pid)</code>ëŠ” ë‹¨ì¼ pidë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ë˜, ë‚´ë¶€ì ìœ¼ë¡œëŠ” í•´ë‹¹ pagetableì„ ê³µìœ í•˜ëŠ” ëª¨ë“  procì„ ì¢…ë£Œ ì²˜ë¦¬í•´ì•¼ í•œë‹¤.</p><p><strong>ë³€ê²½ ì‚¬í•­</strong></p><ul><li><code>kill()</code> ë‚´ë¶€ì—ì„œ <code>target-&gt;pagetable</code>ì„ ê¸°ì¤€ìœ¼ë¡œ, ê°™ì€ pagetableì„ ê³µìœ í•˜ëŠ” ëª¨ë“  procì— ëŒ€í•´ <code>p-&gt;killed = 1</code> ì„¤ì •</li><li><code>SLEEPING</code> ìƒíƒœì¸ threadëŠ” <code>RUNNABLE</code>ë¡œ ë³€ê²½í•˜ì—¬ <code>sched()</code>ì— ì§„ì… ê°€ëŠ¥í•˜ê²Œ í•¨</li></ul><h4 id="_8-separate-wait-join" tabindex="-1"><a class="header-anchor" href="#_8-separate-wait-join"><span>8. Separate wait/join</span></a></h4><ul><li>ê¸°ì¡´ì˜ <code>wait()</code>ëŠ” processë§Œ ìˆ˜ê±°í•´ì•¼ í•œë‹¤.</li><li>threadëŠ” <code>join()</code>ì„ í†µí•´ ìˆ˜ê±°í•˜ë¯€ë¡œ <code>wait()</code>ì™€ëŠ” ë…ë¦½ì ìœ¼ë¡œ êµ¬í˜„ëœë‹¤.</li><li><code>join()</code>ì€ <code>proc[NPROC]</code>ì„ ìˆœíšŒí•˜ë©° <code>parent == myproc()</code>ì´ê³  <code>is_thread == 1</code>ì´ë©° <code>ZOMBIE</code> ìƒíƒœì¸ threadë¥¼ ì°¾ì•„ íšŒìˆ˜í•œë‹¤.</li></ul><h4 id="_9-guarantee-sleep-wakeup-semantics" tabindex="-1"><a class="header-anchor" href="#_9-guarantee-sleep-wakeup-semantics"><span>9. Guarantee sleep/wakeup Semantics</span></a></h4><p>threadê°€ <code>sleep()</code> ìƒíƒœì— ë“¤ì–´ê°ˆ ë•Œ, <code>p-&gt;lock</code>ì„ ë°˜ë“œì‹œ ë¨¼ì € íšë“í•œ í›„ <code>sched()</code>ë¡œ ë„˜ê²¨ì•¼ <code>wakeup()</code>ì—ì„œì˜ ë™ê¸°í™” ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ êµ¬ì¡°ëŠ” ê¸°ì¡´ xv6ì—ì„œ ê·¸ëŒ€ë¡œ ìœ ì§€ë˜ë©°, thread í™˜ê²½ì—ì„œë„ ë¬¸ì œê°€ ì—†ë‹¤.</p><h3 id="design-key-summary" tabindex="-1"><a class="header-anchor" href="#design-key-summary"><span>Design Key Summary</span></a></h3><table><thead><tr><th>Element</th><th>Implementation Strategy Summary</th></tr></thead><tbody><tr><td>Address Space</td><td><code>uvmshare()</code>ë¡œ parentì˜ pagetable ê³µìœ </td></tr><tr><td>User Stack</td><td><code>sbrk(PGSIZE)</code>ë¡œ í™•ë³´, <code>clone()</code>ì— ì „ë‹¬í•˜ì—¬ <code>trapframe-&gt;sp</code> ì„¤ì •</td></tr><tr><td>Function Pointer Entry</td><td><code>trapframe-&gt;epc = fcn</code></td></tr><tr><td>Argument Passing</td><td><code>a0 = arg1</code>, <code>a1 = arg2</code></td></tr><tr><td>TCB Separation</td><td><code>allocproc()</code> â†’ ë…ë¦½ëœ trapframe/context</td></tr><tr><td>Thread Identification</td><td><code>is_thread == 1</code></td></tr><tr><td><code>exec</code> Cleanup</td><td>ë™ì¼ pagetable ê³µìœ í•˜ëŠ” proc ì „ë¶€ <code>freeproc()</code></td></tr><tr><td>join Collection</td><td><code>copyout()</code>ìœ¼ë¡œ stack ì£¼ì†Œ ìœ ì €ì—ê²Œ ì „ë‹¬</td></tr><tr><td><code>kill()</code> Extension</td><td>ê°™ì€ pagetable ê°€ì§„ ëª¨ë“  procì— ëŒ€í•´ <code>killed = 1</code> ì„¤ì •</td></tr><tr><td>Synchronization</td><td><code>sleep()</code> ì „ <code>p-&gt;lock</code> í™•ë³´, <code>sched()</code> ì´í›„ wakeup ê°€ëŠ¥ ë³´ì¥</td></tr></tbody></table><p>ì´ëŸ¬í•œ ì¼ê´€ëœ ì„¤ê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, xv6 ìœ„ì— ì•ˆì „í•˜ê³  ê°€ë²¼ìš´ kernel thread ì‹œìŠ¤í…œì„ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆìœ¼ë©°, ì´ëŠ” ê³¼ì œ ëª…ì„¸ì—ì„œ ì œê³µí•œ <code>thread_test.c</code>ì˜ ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•¨ìœ¼ë¡œì¨ ê·¸ ê¸°ëŠ¥ì  ì™„ì„±ë„ë¥¼ ì…ì¦í•˜ì˜€ë‹¤.</p><h2 id="implementation" tabindex="-1"><a class="header-anchor" href="#implementation"><span>Implementation</span></a></h2><h3 id="overall-structure-overview" tabindex="-1"><a class="header-anchor" href="#overall-structure-overview"><span>Overall Structure Overview</span></a></h3><p>ì´ë²ˆ projectëŠ” xv6ì˜ kernelê³¼ ì‚¬ìš©ì ì˜ì—­ ì–‘ìª½ì— ê±¸ì³ <strong>thread ì‹œìŠ¤í…œ ì „ë°˜ì„ ì•„ìš°ë¥´ëŠ” êµ¬í˜„ ë³€ê²½</strong>ì„ í•„ìš”ë¡œ í•œë‹¤. êµ¬í˜„ì€ í¬ê²Œ ì•„ë˜ 4ê°€ì§€ layerë¡œ ë‚˜ë‰œë‹¤.</p><ul><li><strong>ì‹œìŠ¤í…œ ì½œ ì¸í„°í˜ì´ìŠ¤ (sysproc.c)</strong></li><li><strong>kernel ë‚´ë¶€ ê¸°ëŠ¥ (proc.c)</strong></li><li><strong>ì‚¬ìš©ì ìˆ˜ì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ (user/thread.c, thread.h)</strong></li><li><strong>ë¹Œë“œ ì‹œìŠ¤í…œ ë° ì‹¤í–‰ íŒŒì¼ êµ¬ì„± (Makefile ë³€ê²½)</strong></li></ul><p>ê° ì˜ì—­ì— ëŒ€í•´ ì„¸ë¶€ êµ¬í˜„ê³¼ í•µì‹¬ ë³€ê²½ í¬ì¸íŠ¸ë¥¼ ìˆœì„œëŒ€ë¡œ ì„¤ëª…í•  ê²ƒì´ë‹¤.</p><h3 id="_1-system-call-implementation-kernel-sysproc-c" tabindex="-1"><a class="header-anchor" href="#_1-system-call-implementation-kernel-sysproc-c"><span>1. System Call Implementation (<code>kernel/sysproc.c</code>)</span></a></h3><h4 id="sys-clone" tabindex="-1"><a class="header-anchor" href="#sys-clone"><span><code>sys_clone()</code></span></a></h4><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line">uint64 <span class="token function">sys_clone</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  uint64 f<span class="token punctuation">,</span> a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> s<span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">argaddr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">argaddr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">argaddr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">argaddr</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>a1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>a2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>argaddr()</code>ëŠ” ë°˜í™˜í˜•ì´ <code>void</code>ì´ë¯€ë¡œ, <code>argraw()</code> ê°’ì„ ê°„ì ‘ì ìœ¼ë¡œ ì°¸ì¡°í•˜ì—¬ ì²˜ë¦¬í•œë‹¤.</li><li>ì¸ìì˜ ìˆœì„œì™€ ì˜ë¯¸ëŠ” <code>clone(void(*fcn)(void*,void*), void*, void*, void*)</code>ì™€ ì •í™•íˆ ì¼ì¹˜í•˜ë„ë¡ ì „ë‹¬ëœë‹¤.</li><li>í•¨ìˆ˜ í¬ì¸í„° ì£¼ì†Œ(<code>fcn</code>)ë„ user space ê°’ì´ë¯€ë¡œ <code>uint64</code>ë¡œ ì²˜ë¦¬í•œë‹¤.</li></ul><h4 id="sys-join" tabindex="-1"><a class="header-anchor" href="#sys-join"><span>sys_join()</span></a></h4><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line">uint64 <span class="token function">sys_join</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  uint64 p<span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">argaddr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>join()</code>ì€ (void**) í˜•íƒœë¡œ user stack addressë¥¼ ì „ë‹¬ë°›ëŠ”ë‹¤.</li><li><code>void **stack</code> í˜•íƒœë¥¼ <code>uint64</code>ë¡œ ë°›ë˜, ì»¤ë„ ë‚´ë¶€ì—ì„œëŠ” type castingìœ¼ë¡œ ë³µì›í•œë‹¤.</li></ul><h3 id="_2-kernel-internal-functions-kernel-proc-c" tabindex="-1"><a class="header-anchor" href="#_2-kernel-internal-functions-kernel-proc-c"><span>2. Kernel Internal Functions (<code>kernel/proc.c</code>)</span></a></h3><h4 id="clone" tabindex="-1"><a class="header-anchor" href="#clone"><span><code>clone()</code></span></a></h4><ul><li><code>allocproc()</code>ì„ í†µí•´ ìƒˆë¡œìš´ TCBë¥¼ í• ë‹¹í•œë‹¤.</li><li><code>uvmshare()</code>ë¡œ ë¶€ëª¨ì™€ ë™ì¼í•œ pagetableì„ ê³µìœ í•œë‹¤.</li><li>trapframeì€ ë¶€ëª¨ì˜ ê²ƒì„ ë³µì‚¬í•˜ê³ , epc/sp/a0/a1 ë“±ì€ ì¸ìë¡œ ì£¼ì–´ì§„ ê°’ì„ ë°˜ì˜í•´ ì„¤ì •í•œë‹¤.</li><li><code>ofile[]</code>ê³¼ <code>cwd</code>ëŠ” <code>filedup()</code>, <code>idup()</code>ì„ í†µí•´ ë³µì‚¬í•œë‹¤.</li><li><code>RUNNABLE</code>ë¡œ ì „í™˜ë˜ë©´ schedulerì— ì˜í•´ ì‹¤í–‰ëœë‹¤.</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line">np<span class="token operator">-&gt;</span>trapframe<span class="token operator">-&gt;</span>epc <span class="token operator">=</span> <span class="token punctuation">(</span>uint64<span class="token punctuation">)</span>fcn<span class="token punctuation">;</span></span>
<span class="line">np<span class="token operator">-&gt;</span>trapframe<span class="token operator">-&gt;</span>sp  <span class="token operator">=</span> <span class="token punctuation">(</span>uint64<span class="token punctuation">)</span>stack <span class="token operator">+</span> PGSIZE<span class="token punctuation">;</span></span>
<span class="line">np<span class="token operator">-&gt;</span>trapframe<span class="token operator">-&gt;</span>a0  <span class="token operator">=</span> <span class="token punctuation">(</span>uint64<span class="token punctuation">)</span>arg1<span class="token punctuation">;</span></span>
<span class="line">np<span class="token operator">-&gt;</span>trapframe<span class="token operator">-&gt;</span>a1  <span class="token operator">=</span> <span class="token punctuation">(</span>uint64<span class="token punctuation">)</span>arg2<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>np-&gt;ustack = (uint64)stack;</code>ì€ joinì—ì„œ stack ì£¼ì†Œë¥¼ ìœ ì €ì— ì „ë‹¬í•˜ê¸° ìœ„í•´ ë”°ë¡œ ì €ì¥í•˜ëŠ” ê°’ì´ë‹¤.</li></ul><h4 id="join" tabindex="-1"><a class="header-anchor" href="#join"><span><code>join()</code></span></a></h4><ul><li><code>proc[]</code> ë°°ì—´ ì „ì²´ë¥¼ ìˆœíšŒí•˜ë©°, <code>parent == myproc()</code>ì´ë©´ì„œ <code>is_thread == 1</code>ì¸ ìì‹ë§Œ í™•ì¸í•œë‹¤.</li><li><code>state == ZOMBIE</code>ì¸ threadë¥¼ ë°œê²¬í•˜ë©´ <code>freeproc()</code>ìœ¼ë¡œ íšŒìˆ˜í•˜ê³ , ê·¸ threadì˜ <code>ustack</code> ê°’ì„ <code>copyout()</code>ì„ í†µí•´ ìœ ì €ì—ê²Œ ì „ë‹¬í•œë‹¤.</li><li>ìˆ˜ê±°í•  threadê°€ ì—†ìœ¼ë©´ sleep ìƒíƒœë¡œ ëŒ€ê¸°í•œë‹¤.</li></ul><h4 id="exec" tabindex="-1"><a class="header-anchor" href="#exec"><span><code>exec()</code></span></a></h4><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">proc</span> <span class="token operator">*</span>q <span class="token operator">=</span> proc<span class="token punctuation">;</span> q <span class="token operator">&lt;</span> <span class="token operator">&amp;</span>proc<span class="token punctuation">[</span>NPROC<span class="token punctuation">]</span><span class="token punctuation">;</span> q<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span><span class="token punctuation">(</span>q <span class="token operator">!=</span> p <span class="token operator">&amp;&amp;</span> q<span class="token operator">-&gt;</span>pagetable <span class="token operator">==</span> p<span class="token operator">-&gt;</span>pagetable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">freeproc</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">release</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>exec</code>ì„ í˜¸ì¶œí•œ í˜„ì¬ threadë¥¼ ì œì™¸í•œ, ê°™ì€ ì£¼ì†Œ ê³µê°„ì„ ê³µìœ í•˜ëŠ” threadë¥¼ ëª¨ë‘ ì œê±°í•œë‹¤.</li><li>ì´ ë™ì‘ì€ ìƒˆë¡œìš´ pagetableì„ ì„¸íŒ…í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤.</li></ul><h4 id="kill" tabindex="-1"><a class="header-anchor" href="#kill"><span><code>kill()</code></span></a></h4><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> proc<span class="token punctuation">;</span> p <span class="token operator">&lt;</span> <span class="token operator">&amp;</span>proc<span class="token punctuation">[</span>NPROC<span class="token punctuation">]</span><span class="token punctuation">;</span> p<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>pagetable <span class="token operator">==</span> target<span class="token operator">-&gt;</span>pagetable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    p<span class="token operator">-&gt;</span>killed <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>state <span class="token operator">==</span> SLEEPING<span class="token punctuation">)</span></span>
<span class="line">      p<span class="token operator">-&gt;</span>state <span class="token operator">=</span> RUNNABLE<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ë‹¨ì¼ <code>pid</code>ê°€ ì•„ë‹Œ <strong>ë™ì¼ ì£¼ì†Œ ê³µê°„(pagetable)ì„ ê³µìœ í•˜ëŠ” ëª¨ë“  proc</strong>ì— ëŒ€í•´ <code>killed = 1</code> ì„¤ì •</li><li>ì´ëŠ” multi-thread í™˜ê²½ì—ì„œ ì˜¬ë°”ë¥¸ <code>kill</code> semanticsë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•¨ì´ë‹¤.</li></ul><h4 id="fork" tabindex="-1"><a class="header-anchor" href="#fork"><span><code>fork()</code></span></a></h4><ul><li>ê¸°ì¡´ê³¼ ê±°ì˜ ë™ì¼í•˜ë‚˜, <code>is_thread = 0</code>ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì—¬ ì™„ì „í•œ process ë³µì œê°€ ë˜ë„ë¡ í•œë‹¤.</li><li>threadê°€ ì•„ë‹Œ processëŠ” ë°˜ë“œì‹œ ë…ë¦½ì ì¸ ì£¼ì†Œ ê³µê°„ì„ ê°€ì§„ë‹¤.</li></ul><h3 id="_3-user-level-library-user-thread-c-user-thread-h" tabindex="-1"><a class="header-anchor" href="#_3-user-level-library-user-thread-c-user-thread-h"><span>3. User-Level Library (<code>user/thread.c</code>, <code>user/thread.h</code>)</span></a></h3><h4 id="thread-create" tabindex="-1"><a class="header-anchor" href="#thread-create"><span><code>thread_create()</code></span></a></h4><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">void</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token function">sbrk</span><span class="token punctuation">(</span>PGSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token punctuation">(</span>uint64<span class="token punctuation">)</span>s <span class="token operator">%</span> PGSIZE<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">return</span> <span class="token function">clone</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Stackì€ ë°˜ë“œì‹œ 4KB ë‹¨ìœ„ë¡œ page-aligned ë˜ì–´ì•¼ í•˜ë©°, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ cloneì´ ì‹¤íŒ¨í•œë‹¤.</li><li>stack í• ë‹¹ì€ ë™ì ì´ë©°, ìœ ì €ê°€ ì§ì ‘ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ì§€ ì•Šì•„ë„ ë‚´ë¶€ì ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤.</li></ul><h4 id="thread-join" tabindex="-1"><a class="header-anchor" href="#thread-join"><span><code>thread_join()</code></span></a></h4><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">void</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">int</span> pid <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">)</span> <span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token operator">-</span>PGSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">return</span> pid<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>joinì´ ì„±ê³µì ìœ¼ë¡œ ì¢…ë£Œëœ threadì˜ stack ì£¼ì†Œë¥¼ ì „ë‹¬í•´ì£¼ë©´, ì´ë¥¼ <code>sbrk(-PGSIZE)</code>ë¡œ ë°˜ë‚©í•˜ì—¬ memory leakì„ ë°©ì§€í•œë‹¤.</li></ul><h4 id="thread-h" tabindex="-1"><a class="header-anchor" href="#thread-h"><span>thread.h</span></a></h4><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">int</span> <span class="token function">thread_create</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>fcn<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg1<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">thread_join</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ì‚¬ìš©ì ë ˆë²¨ APIëŠ” ê¸°ì¡´ pthread ìŠ¤íƒ€ì¼ì„ ëª¨ë°©í•˜ì—¬ ìµœì†Œí•œì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤.</li><li>ì‹¤ì œ ì‹œìŠ¤í…œ ì½œì€ ë‚´ë¶€ì ìœ¼ë¡œ clone/joinì„ í˜¸ì¶œí•œë‹¤.</li></ul><h3 id="_4-build-configuration-changes-makefile-user" tabindex="-1"><a class="header-anchor" href="#_4-build-configuration-changes-makefile-user"><span>4. Build Configuration Changes (<code>Makefile.user</code>)</span></a></h3><div class="language-makefile line-numbers-mode" data-highlighter="prismjs" data-ext="makefile"><pre><code class="language-makefile"><span class="line"><span class="token target symbol"><span class="token variable">$U/_thread_test</span></span><span class="token punctuation">:</span> <span class="token variable">$U/thread_test.o</span> <span class="token variable">$U/thread.o</span> <span class="token variable">$</span><span class="token punctuation">(</span>ULIB<span class="token punctuation">)</span></span>
<span class="line"><span class="token target symbol"><span class="token variable">$U/_thread_fcn</span></span><span class="token punctuation">:</span>  <span class="token variable">$U/thread_fcn.o</span>  <span class="token variable">$</span><span class="token punctuation">(</span>ULIB<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ë³„ë„ë¡œ <code>thread.o</code>ë¥¼ ë§í¬ì— í¬í•¨í•´ì•¼ thread ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—°ê²°ëœë‹¤.</li></ul><div class="language-asm line-numbers-mode" data-highlighter="prismjs" data-ext="asm"><pre><code class="language-asm"><span class="line">entry(&quot;clone&quot;);</span>
<span class="line">entry(&quot;join&quot;);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>user/usys.pl</code> ë˜ëŠ” equivalent íŒŒì¼ì—ì„œ system call tableì— cloneê³¼ joinì„ ëª…ì‹œì ìœ¼ë¡œ ì¶”ê°€í•´ì•¼ user codeì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë‹¤.</li></ul><h3 id="summary-overall-flow" tabindex="-1"><a class="header-anchor" href="#summary-overall-flow"><span>Summary: Overall Flow</span></a></h3><table><thead><tr><th>Implementation Target</th><th>Role Summary</th></tr></thead><tbody><tr><td><code>clone()</code></td><td>ìƒˆë¡œìš´ TCB(proc), ê³µìœ ëœ ì£¼ì†Œ ê³µê°„, ë…ë¦½ëœ trapframe ìƒì„±</td></tr><tr><td><code>join()</code></td><td>ì¢…ë£Œëœ thread íšŒìˆ˜ ë° stack ì£¼ì†Œ ë°˜í™˜</td></tr><tr><td><code>exec()</code></td><td>ê¸°ì¡´ thread ì •ë¦¬ í›„ ìƒˆë¡œìš´ ì£¼ì†Œ ê³µê°„ ë¡œë”©</td></tr><tr><td><code>kill()</code></td><td>thread í¬í•¨ ëª¨ë“  ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ</td></tr><tr><td><code>thread_create()</code></td><td>ìŠ¤íƒ í• ë‹¹ + clone ì‹œìŠ¤í…œ ì½œ ë˜í•‘</td></tr><tr><td><code>thread_join()</code></td><td><code>join</code> í˜¸ì¶œ í›„ ìŠ¤íƒ ë°˜ë‚©</td></tr></tbody></table><p>ì´ë¡œì¨ xv6 ë‚´ì— ê²½ëŸ‰í™”ëœ multithreading í™˜ê²½ì´ êµ¬ì¶•ë˜ë©°, <code>fork</code>ì™€ <code>exec</code>ì˜ ê¸°ì¡´ ì˜ë¯¸ë¥¼ ì¹¨í•´í•˜ì§€ ì•Šìœ¼ë©´ì„œë„ thread ê¸°ë°˜ ë³‘ë ¬ ì²˜ë¦¬ì™€ ìì› ê³µìœ ê°€ ê°€ëŠ¥í•´ì§„ë‹¤.</p><h2 id="results" tabindex="-1"><a class="header-anchor" href="#results"><span>Results</span></a></h2><p>ê° testì—ì„œ ìˆ˜ì—…ì—ì„œ ì œê³µëœ ì¶œë ¥ ì˜ˆì‹œì™€ ì‹¤ì œ ì‹¤í–‰ ê²°ê³¼ì˜ ì°¨ì´ë¥¼ ë¹„êµí•˜ê³ , ê·¸ ì°¨ì´ê°€ ë°œìƒí•œ ì›ì¸ì„ ë¶„ì„í•˜ë©°, ê²°ê³¼ê°€ ë…¼ë¦¬ì ìœ¼ë¡œ íƒ€ë‹¹í•œì§€ë¥¼ ì„¤ëª…í•œë‹¤. ì•„ë˜ëŠ” <code>user/thread_test.c</code> ì‹¤í–‰ ê²°ê³¼ì´ë‹¤. ì´ 6ê°œì˜ testë¥¼ ëª¨ë‘ í†µê³¼í•˜ì˜€ìœ¼ë©°, ê°ê°ì˜ testëŠ” íŠ¹ì • thread ê¸°ëŠ¥ì˜ ì •ìƒ ì‘ë™ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.</p><h3 id="test-1-thread-creation-and-global-variable-sharing" tabindex="-1"><a class="header-anchor" href="#test-1-thread-creation-and-global-variable-sharing"><span>TEST#1: Thread Creation and Global Variable Sharing</span></a></h3><h4 id="comparison" tabindex="-1"><a class="header-anchor" href="#comparison"><span>Comparison</span></a></h4><ul><li>ì˜ˆì‹œ ì¶œë ¥ì—ì„œëŠ” thread 1, 2, 3ì´ ë¨¼ì € ì‹¤í–‰ë˜ê³  ì¢…ë£Œëœ ë’¤, thread 0ì´ ë§ˆì§€ë§‰ì— ì‹¤í–‰ëœë‹¤.</li><li>ì‹¤ì œ ê²°ê³¼ì—ì„œëŠ” thread 0ì´ ê°€ì¥ ë¨¼ì € ì‹¤í–‰ì„ ì‹œì‘í•˜ê³ , ê·¸ ë’¤ë¡œ 1~4ë²ˆ threadê°€ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.</li></ul><h4 id="analysis" tabindex="-1"><a class="header-anchor" href="#analysis"><span>Analysis</span></a></h4><ul><li>thread 0ì´ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ê²ƒì€ ìŠ¤ì¼€ì¤„ë§ ë°©ì‹ì˜ ì°¨ì´ì— ë”°ë¥¸ ê²ƒì´ë‹¤.</li><li>ê° threadì˜ ì‹¤í–‰ ìˆœì„œì™€ ì¢…ë£Œ ì‹œì ì€ ì˜ˆì‹œì™€ ë‹¤ë¥´ì§€ë§Œ, ì „ì—­ ë³€ìˆ˜ì˜ ìˆ˜ì • ë° main threadì—ì„œ ê·¸ ê²°ê³¼ë¥¼ í™•ì¸í•˜ëŠ” íë¦„ì€ ë™ì¼í•˜ê²Œ ìœ ì§€ëœë‹¤.</li></ul><h4 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h4><ul><li>ë…¼ë¦¬ì ìœ¼ë¡œ ë¬¸ì œê°€ ì—†ìœ¼ë©°, xv6ì˜ round-robin schedulerì— ë”°ë¼ ì‹¤í–‰ ìˆœì„œëŠ” ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¶œë ¥ ìˆœì„œì˜ ì°¨ì´ëŠ” í—ˆìš©ë˜ëŠ” ê²ƒìœ¼ë¡œ ë´ì•¼ í•  ê²ƒì´ë‹¤.</li></ul><h3 id="test-2-argument-passing-and-independent-execution" tabindex="-1"><a class="header-anchor" href="#test-2-argument-passing-and-independent-execution"><span>TEST#2: Argument Passing and Independent Execution</span></a></h3><h4 id="comparison-1" tabindex="-1"><a class="header-anchor" href="#comparison-1"><span>Comparison</span></a></h4><ul><li>ì˜ˆì‹œì—ì„œëŠ” ê° threadê°€ ì „ë‹¬ë°›ì€ <code>iter</code> ê°’ì„ ì •í™•íˆ ì¶œë ¥í•œë‹¤.</li><li>ì‹¤ì œ ê²°ê³¼ì—ì„œë„ <code>iter</code> ê°’ì´ <code>0</code>ë¶€í„° <code>4000</code>ê¹Œì§€ ì •í™•íˆ ì¶œë ¥ëœë‹¤.</li></ul><h4 id="conclusion-1" tabindex="-1"><a class="header-anchor" href="#conclusion-1"><span>Conclusion</span></a></h4><ul><li>ì¶œë ¥ í˜•ì‹ê³¼ ìˆœì„œê°€ ëª¨ë‘ ì¼ì¹˜í•˜ë©°, ê¸°ëŠ¥ì ìœ¼ë¡œë„ ì™„ë²½íˆ êµ¬í˜„ë˜ì—ˆê¸° ë•Œë¬¸ì— ë³„ë„ì˜ ì„¤ëª… ì—†ì´ <strong>í†µê³¼</strong>ë¡œ íŒë‹¨ëœë‹¤.</li></ul><h3 id="test-3-address-space-isolation-after-fork" tabindex="-1"><a class="header-anchor" href="#test-3-address-space-isolation-after-fork"><span>TEST#3: Address Space Isolation After Fork</span></a></h3><h4 id="comparison-2" tabindex="-1"><a class="header-anchor" href="#comparison-2"><span>Comparison</span></a></h4><ul><li>ì˜ˆì‹œì—ì„œëŠ” ê° threadê°€ forkí•œ ìì‹ processì—ì„œ &quot;start&quot; ë° &quot;end&quot; ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•œë‹¤.</li><li>ì‹¤ì œ ê²°ê³¼ì—ì„œë„ ë™ì¼í•œ ë©”ì‹œì§€ê°€ ì¶œë ¥ëœë‹¤.</li></ul><h4 id="conclusion-2" tabindex="-1"><a class="header-anchor" href="#conclusion-2"><span>Conclusion</span></a></h4><ul><li>ì „ì²´ êµ¬ì¡°ì™€ íë¦„ì´ ë™ì¼í•˜ë©°, ì£¼ì†Œ ê³µê°„ ì¶©ëŒ ì—†ì´ fork ì´í›„ ìì‹ threadê°€ ì •ìƒì ìœ¼ë¡œ ë¶„ë¦¬ëœ ë©”ëª¨ë¦¬ì—ì„œ ì‹¤í–‰ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li><li>ë¶€ëª¨ threadê°€ ìì‹ ì˜ ìì‹ threadë¥¼ ì‹¤í–‰ì‹œì¼œ ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬</li><li>ëª¨ë“  ìì‹ê³¼ ë¶€ëª¨ threadê°€ ì •ìƒ ì¢…ë£Œ</li><li><strong>ê²°ê³¼: nested thread ìƒì„± ë° ì‹¤í–‰ ì •ìƒ ì²˜ë¦¬</strong></li></ul><h3 id="test-4-sbrk-and-memory-allocation-boundary-protection" tabindex="-1"><a class="header-anchor" href="#test-4-sbrk-and-memory-allocation-boundary-protection"><span>TEST#4: sbrk and Memory Allocation Boundary Protection</span></a></h3><h4 id="comparison-3" tabindex="-1"><a class="header-anchor" href="#comparison-3"><span>Comparison</span></a></h4><ul><li>ì˜ˆì‹œì—ì„œëŠ” <code>addr n at break = 0x...</code> í˜•íƒœì˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•œë‹¤.</li><li>ì‹¤ì œ ê²°ê³¼ì—ì„œëŠ” ì—¬ëŸ¬ threadê°€ ì ‘ê·¼í•˜ë©´ì„œ <code>usertrap</code> ë° <code>scause 0xf</code> ì—ëŸ¬ ë©”ì‹œì§€ê°€ ì¶œë ¥ëœë‹¤.</li></ul><h4 id="analysis-1" tabindex="-1"><a class="header-anchor" href="#analysis-1"><span>Analysis</span></a></h4><ul><li>ì˜ˆì‹œëŠ” user programì´ ì§ì ‘ í• ë‹¹ ì£¼ì†Œë¥¼ ì¶œë ¥í•œ ë°˜ë©´, ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì»¤ë„ ìˆ˜ì¤€ì—ì„œ ë©”ëª¨ë¦¬ ë³´í˜¸ ê¸°ì‘ì´ ë™ì‘í•˜ì—¬ trapì´ ë°œìƒí–ˆë‹¤.</li><li>ì´ëŠ” threadê°€ í• ë‹¹í•˜ì§€ ì•Šì€ pageì— ì ‘ê·¼í–ˆì„ ë•Œ ë³´í˜¸ê°€ ë°œìƒí–ˆëŠ”ì§€ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ì´ë©°, ì˜ˆìƒëœ ë™ì‘ì´ë‹¤.</li></ul><h4 id="conclusion-3" tabindex="-1"><a class="header-anchor" href="#conclusion-3"><span>Conclusion</span></a></h4><ul><li>ì˜¤íˆë ¤ trapì´ ë°œìƒí•¨ìœ¼ë¡œì¨ ë³´í˜¸ë˜ì§€ ì•Šì€ ë©”ëª¨ë¦¬ ì ‘ê·¼ì„ ì°¨ë‹¨í•¨ì„ ì¦ëª…í•˜ì˜€ê³ , ì´ëŠ” testì˜ ì˜ë„ì™€ ë¶€í•©í•˜ë¯€ë¡œ í†µê³¼ë¡œ ê°„ì£¼í•  ìˆ˜ ìˆë‹¤.</li><li>thread 0ì—ì„œ <code>sbrk()</code>ë¡œ ë©”ëª¨ë¦¬ í™•ì¥</li><li>ê° threadëŠ” ê³µìœ ëœ ì£¼ì†Œ ê³µê°„ì— ëŒ€í•œ ì ‘ê·¼ ì‹œë„</li><li>ì—¬ëŸ¬ threadì—ì„œ ì ‘ê·¼ ì˜¤ë¥˜(scause 0xf) ë°œìƒ â†’ ì˜ˆìƒëœ í–‰ë™</li><li><strong>ê²°ê³¼: ì£¼ì†Œ ê³µê°„ ê³µìœ ì™€ memory boundary test ì„±ê³µ</strong></li></ul><h3 id="test-5-shared-pid-and-kill-behavior" tabindex="-1"><a class="header-anchor" href="#test-5-shared-pid-and-kill-behavior"><span>TEST#5: Shared PID and Kill Behavior</span></a></h3><h4 id="comparison-4" tabindex="-1"><a class="header-anchor" href="#comparison-4"><span>Comparison</span></a></h4><ul><li>ì˜ˆì‹œì—ì„œëŠ” thread 2ë§Œ ì¡°ê¸° ì¢…ë£Œëœë‹¤.</li><li>ì‹¤ì œ ê²°ê³¼ì—ì„œëŠ” ëª¨ë“  threadê°€ ë™ì¼í•œ <code>pid</code>ë¡œ ì‹œì‘í•˜ê³ , thread 0ì˜ ì¢…ë£Œ ë©”ì‹œì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ ì¶œë ¥ëœë‹¤.</li></ul><h4 id="analysis-2" tabindex="-1"><a class="header-anchor" href="#analysis-2"><span>Analysis</span></a></h4><ul><li>ëª¨ë“  threadê°€ ë™ì¼í•œ <code>pid</code>ë¥¼ ê³µìœ í•˜ëŠ” ì ì€ ì˜ˆìƒëœ ê²°ê³¼ì´ë©°, thread 2ì˜ ì¢…ë£Œ ë¡œê·¸ ëˆ„ë½ì€ scheduling timing ì°¨ì´ì¼ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.</li><li>join ì´í›„ mainì´ ì¢…ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ë‚˜ë¨¸ì§€ threadë“¤ë„ í•¨ê»˜ ì¢…ë£Œëœ ê²ƒì´ë‹¤.</li></ul><h4 id="conclusion-4" tabindex="-1"><a class="header-anchor" href="#conclusion-4"><span>Conclusion</span></a></h4><ul><li><code>kill</code> ê´€ë ¨ ë™ì‘ì€ ì œëŒ€ë¡œ ë°˜ì˜ë˜ì—ˆê³ , ëª¨ë“  threadê°€ ë™ì¼í•œ processì˜ ì¼ë¶€ë¡œ ì •ìƒ ì¢…ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ê¸°ëŠ¥ êµ¬í˜„ì— ë¬¸ì œëŠ” ì—†ë‹¤.</li><li>ëª¨ë“  threadê°€ ë™ì¼í•œ <code>PID(29)</code>ë¡œ ì¶œë ¥ë¨</li><li>ì´ëŠ” threadê°€ ë…ë¦½ì ì¸ processê°€ ì•„ë‹˜ì„ ì¦ëª…</li><li><strong>ê²°ê³¼: ëª¨ë“  threadëŠ” ë™ì¼í•œ process ë‚´ì—ì„œ ì‹¤í–‰ë¨</strong></li></ul><h3 id="test-6-exec-and-thread-termination-behavior" tabindex="-1"><a class="header-anchor" href="#test-6-exec-and-thread-termination-behavior"><span>TEST#6: exec and Thread Termination Behavior</span></a></h3><h4 id="comparison-5" tabindex="-1"><a class="header-anchor" href="#comparison-5"><span>Comparison</span></a></h4><ul><li>ì˜ˆì‹œì—ì„œëŠ” exec ì´í›„ &quot;thread exec test 0&quot; ë©”ì‹œì§€ê°€ ì¶œë ¥ëœë‹¤.</li><li>ì‹¤ì œ ê²°ê³¼ì—ì„œëŠ” ì¼ë¶€ threadê°€ ë¨¼ì € trapì„ ë°œìƒì‹œí‚¤ê³  ì´í›„ ë™ì¼í•œ ë©”ì‹œì§€ê°€ ì¶œë ¥ëœë‹¤.</li></ul><h4 id="analysis-3" tabindex="-1"><a class="header-anchor" href="#analysis-3"><span>Analysis</span></a></h4><ul><li>execì´ í˜¸ì¶œë˜ë©´ ì£¼ì†Œ ê³µê°„ì´ ìƒˆë¡œìš´ program imageë¡œ ëŒ€ì²´ë˜ë©°, ê¸°ì¡´ì˜ ëª¨ë“  threadëŠ” ì¢…ë£Œëœë‹¤.</li><li>ê·¸ì— ë”°ë¼ ì ‘ê·¼ ë¶ˆê°€ëŠ¥í•œ ê³µê°„ì— ìˆë˜ threadë“¤ì´ trapì„ ë°œìƒì‹œí‚¨ ë’¤, ìƒˆë¡œ ì‹¤í–‰ëœ imageê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ëœ ê²ƒì´ë‹¤.</li></ul><h4 id="conclusion-5" tabindex="-1"><a class="header-anchor" href="#conclusion-5"><span>Conclusion</span></a></h4><ul><li>ëª¨ë“  trapì€ execì— ë”°ë¥¸ ì˜ë„ëœ ë¶€ì‘ìš©ì´ë©°, exec ì´í›„ programì´ ì •ìƒ ì‹¤í–‰ë˜ì—ˆê¸° ë•Œë¬¸ì— ì˜¬ë°”ë¥¸ ë™ì‘ìœ¼ë¡œ íŒë‹¨ëœë‹¤.</li><li><code>thread 0</code>ì´ <code>exec()</code>ì„ í˜¸ì¶œí•˜ì—¬ ìƒˆë¡œìš´ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ë³€í™˜</li><li>ë‹¤ë¥¸ threadë“¤ì€ ì˜ˆìƒëŒ€ë¡œ ë¹„ì •ìƒ ì¢…ë£Œ (scause <code>0x2</code> / <code>0xd</code>)</li><li><code>exec()</code> ì´í›„ ìƒˆë¡œìš´ í”„ë¡œê·¸ë¨ì´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë¨ì„ í™•ì¸</li><li><strong>ê²°ê³¼: exec ì´í›„ ì „ì²´ process context êµì²´ ì„±ê³µ</strong></li></ul><h2 id="final-conclusion" tabindex="-1"><a class="header-anchor" href="#final-conclusion"><span>Final Conclusion</span></a></h2><ul><li>ì´ 6ê°œì˜ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼</li><li>xv6ì— ì»¤ë„ ìˆ˜ì¤€ì˜ threadë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë„ì… ë° ê²€ì¦ ì™„ë£Œ</li><li>ì£¼ìš” ê¸°ëŠ¥(ìƒì„±, ì¢…ë£Œ, ë©”ëª¨ë¦¬ ê³µìœ , PID ì¼ì¹˜, <code>exec</code> ì²˜ë¦¬ ë“±) ì „ë°˜ì ìœ¼ë¡œ ê¸°ëŒ€ ë™ì‘ ìˆ˜í–‰</li><li>ìˆ˜ì—…ì—ì„œ ì œê³µëœ ì˜ˆì‹œ ì¶œë ¥ê³¼ ì‹¤í–‰ ìˆœì„œ ë˜ëŠ” ë©”ì‹œì§€ê°€ ì¼ë¶€ ë‹¤ë¥´ì§€ë§Œ, ì´ëŠ” xv6ì˜ scheduler íŠ¹ì„±ìƒ ìì—°ìŠ¤ëŸ¬ìš´ ì°¨ì´ì´ë‹¤.</li><li>ëª¨ë“  testì˜ í•µì‹¬ ê¸°ëŠ¥ì€ ì •í™•íˆ êµ¬í˜„ë˜ì—ˆìœ¼ë©°, trap ë°œìƒ ë˜í•œ ë©”ëª¨ë¦¬ ë³´í˜¸ ê¸°ë²•ì´ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í–ˆìŒì„ ì˜ë¯¸í•œë‹¤.</li><li>ë”°ë¼ì„œ <code>&quot;All tests passed&quot;</code> ë¼ëŠ” ì¶œë ¥ì€ ë…¼ë¦¬ì ìœ¼ë¡œ íƒ€ë‹¹í•˜ê³ , ëª¨ë“  ìš”êµ¬ ì¡°ê±´ì„ ì¶©ì¡±í–ˆë‹¤ê³  íŒë‹¨í•  ìˆ˜ ìˆë‹¤.</li></ul><img src="https://kmbzn.com/images/log.png" width="320"><h2 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting"><span>Troubleshooting</span></a></h2><p>thread êµ¬í˜„ì€ ì „í†µì ì¸ processì™€ ë‹¬ë¦¬ <strong>ì£¼ì†Œ ê³µê°„ ê³µìœ </strong>, <strong>ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬</strong>, <strong>ìì› íšŒìˆ˜ íƒ€ì´ë°</strong> ë“± ë‹¤ì¸µì ì¸ ë¬¸ì œë¥¼ ìˆ˜ë°˜í•œë‹¤. ë³¸ project ì§„í–‰ ê³¼ì •ì—ì„œ ë°œìƒí–ˆë˜ ëŒ€í‘œì ì¸ ë¬¸ì œ ì‚¬ë¡€ë“¤ê³¼, ê·¸ì— ëŒ€í•œ ì›ì¸ ë¶„ì„ ë° í•´ê²° ê³¼ì •ì„ ê¸°ìˆ í•˜ë„ë¡ í•œë‹¤.</p><h3 id="_1-clone-infinite-thread-creation-â†’-pid-explosion" tabindex="-1"><a class="header-anchor" href="#_1-clone-infinite-thread-creation-â†’-pid-explosion"><span>1. <code>clone()</code> Infinite Thread Creation â†’ PID Explosion</span></a></h3><h4 id="issue" tabindex="-1"><a class="header-anchor" href="#issue"><span>Issue</span></a></h4><ul><li><code>thread_create()</code>ê°€ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë˜ë©° <code>clone()</code>ì´ ì‹¤íŒ¨í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ê³„ì†í•´ì„œ pidê°€ ì¦ê°€</li><li><code>pid</code>ê°€ 64ë¥¼ ì´ˆê³¼í•˜ë©° ì‹œìŠ¤í…œì´ ë¹„ì •ìƒ ìƒíƒœì— ì§„ì…</li><li><code>usertrap(): unexpected scause</code> ë˜ëŠ” <code>kerneltrap()</code>ì´ ë‹¤ìˆ˜ ë°œìƒ</li></ul><h4 id="cause" tabindex="-1"><a class="header-anchor" href="#cause"><span>Cause</span></a></h4><ul><li><code>thread_create()</code>ì—ì„œ <code>sbrk(PGSIZE)</code>ë¡œ stackì„ ìš”ì²­í–ˆìœ¼ë‚˜ ì‹¤íŒ¨í•œ ê²½ìš°, ê·¸ stack ì£¼ì†Œê°€ <code>(void*)-1</code>ì´ ë¨</li><li>ì´ ìƒíƒœë¡œë„ <code>clone()</code>ì´ í˜¸ì¶œë˜ë©´, ì»¤ë„ ë‚´ stack validationì—ì„œ ì‹¤íŒ¨í•˜ì—¬ <code>-1</code>ì„ ë°˜í™˜í•˜ì§€ë§Œ, ì‚¬ìš©ì ì½”ë“œëŠ” ì´ë¥¼ ë¬´ì‹œí•¨</li><li>ê·¸ ê²°ê³¼ joinì´ ë¶ˆê°€ëŠ¥í•œ zombie threadê°€ ê³„ì† ìƒì„±ë˜ì–´ <code>proc[]</code>ì„ ì†Œì§„í•¨</li></ul><h4 id="solution" tabindex="-1"><a class="header-anchor" href="#solution"><span>Solution</span></a></h4><ul><li><code>thread_create()</code>ì—ì„œ stackì´ í• ë‹¹ ì‹¤íŒ¨í–ˆê±°ë‚˜ page alignmentê°€ ë§ì§€ ì•Šìœ¼ë©´ <strong>ì¦‰ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬</strong>í•˜ë„ë¡ ë³€ê²½</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">void</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token function">sbrk</span><span class="token punctuation">(</span>PGSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token punctuation">(</span>uint64<span class="token punctuation">)</span>s <span class="token operator">%</span> PGSIZE<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>clone()</code> ë‚´ë¶€ì—ì„œë„ stackì´ NULLì´ê±°ë‚˜ ë²”ìœ„ ë°–ì¸ ê²½ìš° ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stack <span class="token operator">||</span> <span class="token punctuation">(</span>uint64<span class="token punctuation">)</span>stack <span class="token operator">&lt;</span> PGSIZE <span class="token operator">||</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-error-on-fcn-0-â†’-test-failure" tabindex="-1"><a class="header-anchor" href="#_2-error-on-fcn-0-â†’-test-failure"><span>2. Error on <code>fcn == 0</code> â†’ Test Failure</span></a></h3><h4 id="issue-1" tabindex="-1"><a class="header-anchor" href="#issue-1"><span>Issue</span></a></h4><ul><li><code>clone()</code> ë‚´ì—ì„œ <code>if (!fcn) return -1;</code> ì¡°ê±´ì„ ì„¤ì •í•œ í›„, ëª¨ë“  thread ìƒì„±ì´ ì‹¤íŒ¨</li><li><code>thread_test</code>ì—ì„œ <code>Thread 0 start</code>ì¡°ì°¨ ì¶œë ¥ë˜ì§€ ì•ŠìŒ</li></ul><h4 id="cause-1" tabindex="-1"><a class="header-anchor" href="#cause-1"><span>Cause</span></a></h4><ul><li>ìˆ˜ì—…ì—ì„œ ì œê³µí•œ test codeì—ì„œ <code>thread_basic()</code> í•¨ìˆ˜ì˜ ì£¼ì†Œê°€ ì‹¤ì œë¡œ <code>0x0</code>ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ</li><li>ì´ëŠ” xv6ì˜ linker ë° loader ì„¤ì • ìƒ ì¼ë¶€ í•¨ìˆ˜ê°€ <code>.text</code> ì„¸ê·¸ë¨¼íŠ¸ì˜ ì‹œì‘ ì£¼ì†Œì¸ <code>0x0</code>ì— ë°°ì¹˜ë˜ê¸° ë•Œë¬¸</li><li>xv6 riscv í™˜ê²½ì—ì„œëŠ” <code>epc = 0</code>ì´ trap ì—†ì´ ìœ íš¨í•˜ê²Œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë©°, <code>0x0</code> ì£¼ì†ŒëŠ” ì •ìƒì ì¸ ì‹¤í–‰ ì§„ì…ì ì„</li></ul><h4 id="solution-1" tabindex="-1"><a class="header-anchor" href="#solution-1"><span>Solution</span></a></h4><ul><li><code>clone()</code> ë‚´ <code>fcn</code> null-check ì¡°ê±´ì„ <strong>ì™„ì „íˆ ì œê±°</strong></li><li>ëŒ€ì‹  <code>walkaddr()</code>ë¥¼ í†µí•´ í•´ë‹¹ addressê°€ ìœ ì € ì˜ì—­ì— ì¡´ì¬í•˜ëŠ” ìœ íš¨í•œ physical pageë¥¼ ê°€ë¦¬í‚¤ëŠ”ì§€ë§Œ í™•ì¸</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>uint64<span class="token punctuation">)</span>fcn <span class="token operator">&gt;=</span> MAXVA <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">walkaddr</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>pagetable<span class="token punctuation">,</span> <span class="token punctuation">(</span>uint64<span class="token punctuation">)</span>fcn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-join-unable-to-collect-thread-infinite-wait" tabindex="-1"><a class="header-anchor" href="#_3-join-unable-to-collect-thread-infinite-wait"><span>3. join Unable to Collect Thread (Infinite Wait)</span></a></h3><h4 id="issue-2" tabindex="-1"><a class="header-anchor" href="#issue-2"><span>Issue</span></a></h4><ul><li><code>join()</code>ì„ í˜¸ì¶œí–ˆìœ¼ë‚˜ <code>Thread X join failed</code>ê°€ ì¶œë ¥ë˜ë©° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</li><li>threadëŠ” ì¢…ë£Œë˜ì—ˆìœ¼ë‚˜ ì»¤ë„ì´ í•´ë‹¹ ìƒíƒœë¥¼ ì¸ì§€í•˜ì§€ ëª»í•¨</li></ul><h4 id="cause-2" tabindex="-1"><a class="header-anchor" href="#cause-2"><span>Cause</span></a></h4><ul><li>thread ì¢…ë£Œ ì‹œ <code>state == ZOMBIE</code>ê°€ ë˜ì—ˆì§€ë§Œ, <code>join()</code>ì—ì„œ ì ‘ê·¼ ì‹œ <code>np-&gt;lock</code>ì„ íšë“í•˜ì§€ ì•Šê±°ë‚˜, ì´ë¯¸ <code>freeproc()</code> ì´í›„ lockì„ í•´ì œí•œ ë’¤ ìƒíƒœë¥¼ í™•ì¸í•˜ë ¤ í•´ race conditionì´ ë°œìƒ</li><li>ë˜ëŠ” <code>p-&gt;lock</code>ê³¼ <code>wait_lock</code>ì„ ë™ì‹œì— ì‚¬ìš©í•˜ë©´ì„œ deadlockì´ ë°œìƒí•  ìˆ˜ ìˆìŒ</li></ul><h4 id="solution-2" tabindex="-1"><a class="header-anchor" href="#solution-2"><span>Solution</span></a></h4><ul><li><code>join()</code> ë‚´ì—ì„œ ë°˜ë“œì‹œ <code>np-&gt;lock</code>ì„ íšë“í•œ ë’¤ <code>state</code>ë¥¼ í™•ì¸</li><li><code>freeproc()</code>ë„ ë°˜ë“œì‹œ <code>np-&gt;lock</code>ì„ ë³´ìœ í•œ ìƒíƒœì—ì„œ í˜¸ì¶œí•˜ê³ , í•´ì œëŠ” ì´í›„ì— ìˆ˜í–‰</li><li>sleepì€ ë°˜ë“œì‹œ <code>p-&gt;lock</code> ì—†ì´ <code>wait_lock</code>ë§Œ ë³´ìœ í•œ ìƒíƒœì—ì„œë§Œ í˜¸ì¶œí•´ì•¼ í•¨</li></ul><h3 id="_4-other-threads-usertrap-on-exec-â†’-panic" tabindex="-1"><a class="header-anchor" href="#_4-other-threads-usertrap-on-exec-â†’-panic"><span>4. Other Threads usertrap on <code>exec()</code> â†’ panic</span></a></h3><h4 id="issue-3" tabindex="-1"><a class="header-anchor" href="#issue-3"><span>Issue</span></a></h4><ul><li><code>exec()</code> í…ŒìŠ¤íŠ¸(<code>TEST#6</code>) ìˆ˜í–‰ ì‹œ, ë‹¤ë¥¸ threadë“¤ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ log ì¶œë ¥</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">usertrap(): unexpected scause 0x2 pid=36 sepc=0x1000 stval=0xdeadbeef</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>ì´í›„ ì»¤ë„ panic ë˜ëŠ” stack overflow ë°œìƒ</li></ul><h4 id="cause-3" tabindex="-1"><a class="header-anchor" href="#cause-3"><span>Cause</span></a></h4><ul><li><code>exec()</code>ì€ í˜¸ì¶œ threadì˜ pagetableì„ ì™„ì „íˆ ìƒˆë¡œìš´ ê²ƒìœ¼ë¡œ êµì²´í•˜ëŠ” ì‘ì—…ì´ë‹¤.</li><li>ê·¸ëŸ¬ë‚˜ ê°™ì€ pagetableì„ ê³µìœ í•˜ëŠ” ë‹¤ë¥¸ threadë“¤ì´ ì•„ì§ ì‚´ì•„ ìˆê³ , í•´ë‹¹ ì£¼ì†Œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ fetchí•˜ë ¤ê³  í•˜ë©´ invalid memory trapì´ ë°œìƒ</li><li>íŠ¹íˆ, ì´ë¯¸ ì†Œë©¸ëœ í•¨ìˆ˜ ì£¼ì†Œ(<code>fcn</code>)ë¡œ ì í”„í•˜ëŠ” ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒ</li></ul><h4 id="solution-3" tabindex="-1"><a class="header-anchor" href="#solution-3"><span>Solution</span></a></h4><ul><li><code>exec()</code> í˜¸ì¶œ ì‹œ í˜„ì¬ threadë¥¼ ì œì™¸í•œ ë™ì¼ pagetableì˜ threadë¥¼ <code>freeproc()</code>ìœ¼ë¡œ ì œê±°</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">proc</span> <span class="token operator">*</span>q <span class="token operator">=</span> proc<span class="token punctuation">;</span> q <span class="token operator">&lt;</span> <span class="token operator">&amp;</span>proc<span class="token punctuation">[</span>NPROC<span class="token punctuation">]</span><span class="token punctuation">;</span> q<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span><span class="token punctuation">(</span>q <span class="token operator">!=</span> p <span class="token operator">&amp;&amp;</span> q<span class="token operator">-&gt;</span>pagetable <span class="token operator">==</span> p<span class="token operator">-&gt;</span>pagetable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">freeproc</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">release</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ê²°ê³¼ì ìœ¼ë¡œ, <code>exec()</code>ëŠ” í•´ë‹¹ processë¥¼ thread ë‹¨ìœ„ê°€ ì•„ë‹Œ &quot;ì£¼ì†Œ ê³µê°„ ë‹¨ìœ„&quot;ë¡œ ì™„ì „íˆ ì¬ì‹œì‘í•˜ëŠ” í•¨ìˆ˜ë¡œ ë³´ì•„ì•¼ í•œë‹¤.</li></ul><h3 id="_5-only-some-threads-terminated-on-kill-pid-â†’-zombie-leak" tabindex="-1"><a class="header-anchor" href="#_5-only-some-threads-terminated-on-kill-pid-â†’-zombie-leak"><span>5. Only Some Threads Terminated on <code>kill(pid)</code> â†’ zombie leak</span></a></h3><h4 id="issue-4" tabindex="-1"><a class="header-anchor" href="#issue-4"><span>Issue</span></a></h4><ul><li><code>kill(main_pid)</code> í˜¸ì¶œ ì‹œ ì¼ë¶€ threadëŠ” ì—¬ì „íˆ ëŒê³  ìˆìœ¼ë©°, <code>join()</code>ë„ ë°˜í™˜í•˜ì§€ ì•ŠìŒ</li><li><code>TEST#5</code>ì—ì„œ thread ì¤‘ í•˜ë‚˜ë§Œ ì¢…ë£Œí•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ë¬´í•œ ë£¨í”„ì— ë¹ ì§</li></ul><h4 id="cause-4" tabindex="-1"><a class="header-anchor" href="#cause-4"><span>Cause</span></a></h4><ul><li>ê¸°ì¡´ <code>kill()</code> êµ¬í˜„ì€ <code>pid</code>ì™€ ì¼ì¹˜í•˜ëŠ” ë‹¨ì¼ processë§Œ ì¢…ë£Œ ì²˜ë¦¬í•¨</li><li>ê·¸ëŸ¬ë‚˜ thread êµ¬ì¡°ì—ì„œëŠ” í•˜ë‚˜ì˜ ì£¼ì†Œ ê³µê°„ì— ì—¬ëŸ¬ threadê°€ ì¡´ì¬í•˜ë©°, ê°œë³„ pidë§Œ ì¢…ë£Œí•´ì„  íš¨ê³¼ê°€ ì—†ìŒ</li></ul><h4 id="solution-4" tabindex="-1"><a class="header-anchor" href="#solution-4"><span>Solution</span></a></h4><ul><li><code>kill()</code> êµ¬í˜„ì„ í™•ì¥í•˜ì—¬ ë™ì¼í•œ pagetableì„ ê³µìœ í•˜ëŠ” ëª¨ë“  procì— ëŒ€í•´ <code>killed = 1</code> ì„¤ì •</li><li><code>SLEEPING</code> ìƒíƒœì¼ ê²½ìš°, ê°•ì œë¡œ <code>RUNNABLE</code>ë¡œ ë§Œë“¤ì–´ <code>sched()</code>ì— ì§„ì…í•  ìˆ˜ ìˆë„ë¡ í•¨</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> proc<span class="token punctuation">;</span> p <span class="token operator">&lt;</span> <span class="token operator">&amp;</span>proc<span class="token punctuation">[</span>NPROC<span class="token punctuation">]</span><span class="token punctuation">;</span> p<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>pagetable <span class="token operator">==</span> target<span class="token operator">-&gt;</span>pagetable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    p<span class="token operator">-&gt;</span>killed <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>state <span class="token operator">==</span> SLEEPING<span class="token punctuation">)</span></span>
<span class="line">      p<span class="token operator">-&gt;</span>state <span class="token operator">=</span> RUNNABLE<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-stack-memory-leak-after-thread-join" tabindex="-1"><a class="header-anchor" href="#_6-stack-memory-leak-after-thread-join"><span>6. Stack Memory Leak after <code>thread_join()</code></span></a></h3><h4 id="issue-5" tabindex="-1"><a class="header-anchor" href="#issue-5"><span>Issue</span></a></h4><ul><li>thread ìˆ˜ê±° ì´í›„ì—ë„ <code>sbrk()</code>ëœ ë©”ëª¨ë¦¬ê°€ íšŒìˆ˜ë˜ì§€ ì•Šì•„, <code>sbrk(0)</code> ê°’ì´ ê³„ì† ì¦ê°€</li><li>long-running processì—ì„œ memory exhaustion ë°œìƒ</li></ul><h4 id="cause-5" tabindex="-1"><a class="header-anchor" href="#cause-5"><span>Cause</span></a></h4><ul><li><code>join()</code>ì´ stack ì£¼ì†Œë¥¼ ìœ ì €ì—ê²Œ ë„˜ê²¨ì¤¬ì§€ë§Œ, ì‚¬ìš©ìê°€ ì´ë¥¼ ë°˜ë‚©í•˜ì§€ ì•ŠìŒ</li><li><code>thread_join()</code>ì€ <code>join()</code>ì„ í˜¸ì¶œë§Œ í•˜ê³  ë©”ëª¨ë¦¬ íšŒìˆ˜ëŠ” í•˜ì§€ ì•ŠìŒ</li></ul><h4 id="solution-5" tabindex="-1"><a class="header-anchor" href="#solution-5"><span>Solution</span></a></h4><ul><li>ì‚¬ìš©ì ë¼ì´ë¸ŒëŸ¬ë¦¬ ìˆ˜ì¤€ì—ì„œ <code>thread_join()</code> ë‚´ë¶€ì—ì„œ ì§ì ‘ <code>sbrk(-PGSIZE)</code> í˜¸ì¶œ</li><li>stack ì£¼ì†Œê°€ 0ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í•´ì œ</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">)</span> <span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token operator">-</span>PGSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_7-sleep-wakeup-deadlock" tabindex="-1"><a class="header-anchor" href="#_7-sleep-wakeup-deadlock"><span>7. sleep/wakeup Deadlock</span></a></h3><h4 id="issues" tabindex="-1"><a class="header-anchor" href="#issues"><span>Issues</span></a></h4><ul><li><code>join()</code>ì—ì„œ <code>sleep(p, &amp;wait_lock)</code> ì´í›„ ê¹¨ì–´ë‚˜ì§€ ì•Šê±°ë‚˜, wakeup ì´í›„ì—ë„ ìƒíƒœê°€ ë³µêµ¬ë˜ì§€ ì•ŠìŒ</li><li>Debugging ì‹œ <code>sched()</code> ì§„ì… í›„ ë‹¤ì‹œ ëŒì•„ì˜¤ì§€ ì•Šê±°ë‚˜ <code>panic: unlock</code> ë°œìƒ</li></ul><h4 id="cause-6" tabindex="-1"><a class="header-anchor" href="#cause-6"><span>Cause</span></a></h4><ul><li><code>sleep()</code>ì€ ë‚´ë¶€ì ìœ¼ë¡œ <code>p-&gt;lock</code>ì„ ìš”êµ¬í•˜ë©°, ì™¸ë¶€ì—ì„œ ì´ë¯¸ <code>p-&gt;lock</code>ì„ íšë“í•œ ìƒíƒœë¡œ ë“¤ì–´ì˜¤ë©´ ì¤‘ë³µ lockìœ¼ë¡œ crash</li><li>ë˜ëŠ” <code>wakeup()</code>ê³¼ <code>sleep()</code> ì‚¬ì´ì˜ windowì—ì„œ race conditionì´ ë°œìƒí•  ìˆ˜ ìˆìŒ</li></ul><h4 id="solution-6" tabindex="-1"><a class="header-anchor" href="#solution-6"><span>Solution</span></a></h4><ul><li><code>sleep()</code> í˜¸ì¶œ ì „ ë°˜ë“œì‹œ <code>p-&gt;lock</code>ì´ <strong>íšë“ë˜ì–´ ìˆì§€ ì•Šë„ë¡ ì„¤ê³„</strong></li><li><code>sleep()</code> ë‚´ë¶€ì—ì„œ <code>p-&gt;lock</code>ì„ íšë“í•˜ë©°, ì™¸ë¶€ì—ì„œëŠ” <code>wait_lock</code>ë§Œ ë³´ìœ í•´ì•¼ í•¨</li></ul><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">release</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wait_lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token function">sched</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token function">release</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token operator">-&gt;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wait_lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>wakeup()</code>ì€ lock ì—†ì´ ì‘ë™í•´ì•¼ í•˜ë¯€ë¡œ ë³„ë„ë¡œ <code>p-&gt;lock</code>ì„ ê° threadë§ˆë‹¤ íšë“í•˜ê³  ìƒíƒœë¥¼ ë°”ê¿”ì¤Œ</li></ul><h2 id="summary-major-issues-list" tabindex="-1"><a class="header-anchor" href="#summary-major-issues-list"><span>Summary: Major Issues List</span></a></h2><table><thead><tr><th>Issue Code Area</th><th>Cause</th><th>Solution Summary</th></tr></thead><tbody><tr><td><code>thread_create</code></td><td><code>sbrk</code> ì‹¤íŒ¨ ë˜ëŠ” misalignment</td><td>ì‹¤íŒ¨ ì‹œ ë°”ë¡œ <code>return</code></td></tr><tr><td><code>clone</code></td><td><code>fcn == 0</code> ì£¼ì†Œ ê±°ë¶€</td><td><code>fcn</code> null-check ì œê±°, <code>walkaddr</code>ë§Œìœ¼ë¡œ ìœ íš¨ì„± í™•ì¸</td></tr><tr><td><code>join</code></td><td>lock ë³´í˜¸ ë¯¸í¡</td><td>lock ìˆœì„œ ë° <code>freeproc()</code> ë‚´ë¶€ ë™ê¸°í™” ë³´ê°•</td></tr><tr><td><code>exec</code></td><td>ë‹¤ë¥¸ threadê°€ trap ë°œìƒ</td><td>ë™ì¼ pagetable ê³µìœ  thread ì „ë¶€ ì œê±°</td></tr><tr><td><code>kill</code></td><td>ì¼ë¶€ threadë§Œ ì¢…ë£Œë¨</td><td>pagetable ê¸°ì¤€ ì „ì²´ <code>killed</code> ì²˜ë¦¬</td></tr><tr><td><code>thread_join</code></td><td>stack íšŒìˆ˜ ëˆ„ë½</td><td>ë‚´ë¶€ì—ì„œ <code>sbrk(-PGSIZE)</code> í˜¸ì¶œ ì¶”ê°€</td></tr><tr><td><code>sleep/wakeup</code></td><td>deadlock ë˜ëŠ” race condition</td><td>lock ìˆœì„œ ë° <code>wakeup</code> ì‹œì  ì¡°ì •</td></tr></tbody></table><p>ì´ì™€ ê°™ì€ ë°˜ë³µì  debuggingê³¼ ì½”ë“œ ê°œì„ ì„ í†µí•´, xv6ì— ì•ˆì •ì ì´ê³  ì •í™•í•œ kernel ìˆ˜ì¤€ thread ì‹œìŠ¤í…œì„ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆë‹¤.</p><h2 id="additional-content" tabindex="-1"><a class="header-anchor" href="#additional-content"><span>Additional Content</span></a></h2><h3 id="reference-notes-for-thread-implementation-in-xv6-risc-v" tabindex="-1"><a class="header-anchor" href="#reference-notes-for-thread-implementation-in-xv6-risc-v"><span>Reference Notes for Thread Implementation in xv6 RISC-V</span></a></h3><ul><li><p>ë³¸ projectëŠ” <strong>xv6 RISC-V ë²„ì „</strong>ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, x86 ê¸°ë°˜ êµ¬í˜„ ì˜ˆì œë“¤ê³¼ëŠ” êµ¬ì¡°ì ìœ¼ë¡œ ë‹¤ë¥´ë‹¤.</p><ul><li>íŠ¹íˆ <code>ptable[]</code>ì´ ì¡´ì¬í•˜ì§€ ì•Šê³ , <code>proc[NPROC]</code> ë°°ì—´ê³¼ spinlockìœ¼ë¡œë§Œ ë™ê¸°í™”ë¥¼ ìˆ˜í–‰í•œë‹¤.</li><li>ë”°ë¼ì„œ x86ì˜ <code>switchuvm()</code>, <code>loaduvm()</code> ë“±ì˜ ë™ì‘ ë°©ì‹ê³¼ ë‹¬ë¦¬, RISC-Vì—ì„œëŠ” <code>walk()</code> ë° <code>pagetable_t</code>ì— ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ë°©ì‹ì´ í•„ìš”í–ˆë‹¤.</li></ul></li><li><p>xv6ì˜ trapframe, context, scheduler ë“±ì€ thread-safeí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, threadë§ˆë‹¤ ë°˜ë“œì‹œ ë…ë¦½ëœ <code>trapframe</code>, <code>context</code>, <code>ustack</code>ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p></li><li><p><code>uvmshare()</code>ëŠ” ê¸°ì¡´ <code>uvmcopy()</code>ë¥¼ ë³€í˜•í•˜ì—¬ êµ¬í˜„í•œ í•¨ìˆ˜ë¡œ, <code>PTE_U</code> ë¹„íŠ¸ê°€ ì„¤ì •ëœ ì‚¬ìš©ì ì˜ì—­ pageì— ëŒ€í•´ì„œë§Œ ê³µìœ (reference mapping)í•˜ë„ë¡ ì„¤ê³„í•˜ì˜€ë‹¤.</p><ul><li>ì´ëŠ” read-only ì„¸ê·¸ë¨¼íŠ¸ì— ëŒ€í•´ì„œë„ ë¬¸ì œê°€ ì—†ìœ¼ë©°, execì´ë‚˜ forkì™€ëŠ” ë‹¤ë¥¸ ë™ì‘ì„ ë³´ì¥í•œë‹¤.</li></ul></li><li><p><code>thread_fcn.c</code>, <code>thread_test.c</code>ëŠ” ê³¼ì œ ëª…ì„¸ì—ì„œ ì œê³µí•œ ì±„ì  ê¸°ì¤€ íŒŒì¼ì´ë‹¤.</p><ul><li>ì´ íŒŒì¼ì˜ êµ¬ì¡°ë‚˜ <code>fcn = 0x0</code> í˜•íƒœì˜ í˜¸ì¶œ ë°©ì‹ì€ ì •ìƒ ë™ì‘ì´ë©°, panic ìœ ë°œ ìš”ì†Œê°€ ì•„ë‹ˆë‹¤.</li></ul></li><li><p>ëª¨ë“  thread êµ¬í˜„ì€ xv6ì˜ ê¸°ì¡´ ê¸°ëŠ¥ê³¼ ì™„ì „íˆ í˜¸í™˜ë˜ì–´ì•¼ í•˜ë©°, íŠ¹íˆ ë‹¤ìŒê³¼ ê°™ì€ system callë“¤ê³¼ ì—°ë™ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.</p><ul><li><code>fork()</code>, <code>exec()</code>, <code>exit()</code>, <code>wait()</code>, <code>kill()</code>, <code>sleep()</code>, <code>pipe()</code></li></ul></li></ul><h3 id="additional-useful-references" tabindex="-1"><a class="header-anchor" href="#additional-useful-references"><span>Additional Useful References</span></a></h3><p>https://github.com/mit-pdos/xv6-riscv<br> https://pdos.csail.mit.edu/6.828/2022/xv6/book-riscv-rev3.pdf</p><p>ì‹¤ìŠµ ì¤‘ ì°¸ê³ í•œ StackOverflow thread:</p><ul><li>https://stackoverflow.com/questions/78141535/threading-using-jmp-buf-array-in-c-test-in-xv6 (x86 ì¤‘ì‹¬ì´ë¯€ë¡œ êµ¬ì¡°ëŠ” ì°¸ì¡°ìš©)</li></ul><p>ì´ìƒìœ¼ë¡œ ë³¸ projectì˜ ê¸°ìˆ ì  ë°°ê²½ê³¼ ì—°ê´€ëœ ëª¨ë“  í•µì‹¬ ìš”ì†Œë“¤ì„ í¬í•¨í•˜ì˜€ë‹¤.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">ìµœê·¼ ìˆ˜ì •: </span><time class="meta-item-info" datetime="2025-06-14T10:41:32.000Z" data-allow-mismatch>25. 6. 14. ì˜¤í›„ 7:41</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: kmbzn24@hanyang.ac.kr">ê¹€ë³‘ì¤€</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: kmbzn24@gmail.com">kmbzn</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><div class="vp-footer-wrapper" data-v-e24f0054><hr data-v-e24f0054><div class="vp-footer" data-v-e24f0054><p class="built-with" data-v-e24f0054>BUILT WITH</p><div class="tech-logos" data-v-e24f0054><a href="https://www.cloudflare.com/" target="_blank" data-v-e24f0054><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/cloudflare/cloudflare-original.svg" alt="Cloudflare" data-v-e24f0054></a><a href="https://nodejs.org/" target="_blank" data-v-e24f0054><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/nodejs/nodejs-original.svg" alt="Node.js" data-v-e24f0054></a><a href="https://github.com/kmbzn" target="_blank" data-v-e24f0054><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub" data-v-e24f0054></a><a href="https://git-scm.com/" target="_blank" data-v-e24f0054><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/git/git-original.svg" alt="Git" data-v-e24f0054></a><a href="https://vuejs.org/" target="_blank" data-v-e24f0054><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/vuejs/vuejs-original.svg" alt="Vue.js" data-v-e24f0054></a><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank" data-v-e24f0054><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg" alt="JavaScript" data-v-e24f0054></a><a href="https://code.visualstudio.com/" target="_blank" data-v-e24f0054><img src="https://blog.kakaocdn.net/dn/lTWD3/btsMdkdWJqP/b4aSv2aa6c425THE40jKB1/img.png" alt="VSCode" data-v-e24f0054></a><a href="https://www.npmjs.com/" target="_blank" data-v-e24f0054><img src="https://upload.wikimedia.org/wikipedia/commons/d/db/Npm-logo.svg" alt="npm" data-v-e24f0054></a></div><p class="copyright" data-v-e24f0054> All trademarks and logos are property of their respective owners.<br data-v-e24f0054> Â© 2025 kmbzn Â· <a href="https://github.com/kmbzn/blog/blob/master/LICENSE" target="_blank" data-v-e24f0054>MIT License</a><br data-v-e24f0054></p></div></div><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DiAjUdp1.js" defer></script>
  </body>
</html>
